<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Winddoing&#39;s Blog</title>
  
  <subtitle>Follow Excellent, Success will Chase you</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://winddoing.github.io/"/>
  <updated>2019-02-26T07:26:40.414Z</updated>
  <id>http://winddoing.github.io/</id>
  
  <author>
    <name>Winddoing</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ARMv8-aarch64寄存器和指令集</title>
    <link href="http://winddoing.github.io/post/7190.html"/>
    <id>http://winddoing.github.io/post/7190.html</id>
    <published>2019-02-26T06:01:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/2019/02/armv8_a.png" alt="armv8-a"></p><a id="more"></a><h2 id="ARMv8-A处理器属性"><a href="#ARMv8-A处理器属性" class="headerlink" title="ARMv8-A处理器属性"></a>ARMv8-A处理器属性</h2><p><img src="/images/2019/02/armv8_a_properties.png" alt="armv8-a-properties"></p><blockquote><p>Rockchip RK3399 SoC integrates dual-core <code>Cortex-A72</code> and quad-core <code>Cortex-A53</code> with separate NEON coprocessor, and with ARM Mali-T864 GPU.</p></blockquote><h2 id="异常等级"><a href="#异常等级" class="headerlink" title="异常等级"></a>异常等级</h2><p>软件运行异常级别：</p><ul><li><code>EL0</code>： 普通用户应用程序</li><li><code>EL1</code>： 操作系统内核通常被描述为特权</li><li><code>EL2</code>： 管理程序</li><li><code>EL3</code>： 低级固件，包括安全监视器</li></ul><h2 id="ARMv8寄存器"><a href="#ARMv8寄存器" class="headerlink" title="ARMv8寄存器"></a>ARMv8寄存器</h2><p>AArch拥有<code>31</code>个通用寄存器，系统运行在64位状态下的时候名字叫<code>Xn</code>，运行在32位的时候就叫<code>Wn</code>.</p><p><img src="/images/2019/02/armv8_reg.png" alt="armv8-reg"></p><blockquote><p>32位W寄存器构成相应64位X寄存器的下半部分。 也就是说，W0<br>映射到X0的低位字，W1映射到X1的低位字。</p></blockquote><h3 id="特殊寄存器"><a href="#特殊寄存器" class="headerlink" title="特殊寄存器"></a>特殊寄存器</h3><p><img src="/images/2019/02/armv8特殊寄存器.png" alt="armv8特殊寄存器"></p><table><thead><tr><th style="text-align:center">Name</th><th style="text-align:center">Size</th><th style="text-align:center">Description</th></tr></thead><tbody><tr><td style="text-align:center">WZR</td><td style="text-align:center">32bits</td><td style="text-align:center">Zero register</td></tr><tr><td style="text-align:center">XZR</td><td style="text-align:center">64bits</td><td style="text-align:center">Zero register</td></tr><tr><td style="text-align:center">WSP</td><td style="text-align:center">32bits</td><td style="text-align:center">Current stack pointer</td></tr><tr><td style="text-align:center">SP</td><td style="text-align:center">64bits</td><td style="text-align:center">Current stack pointer</td></tr><tr><td style="text-align:center">pC</td><td style="text-align:center">64bits</td><td style="text-align:center">Program counter</td></tr></tbody></table><h2 id="ARM-64位架构的ABI"><a href="#ARM-64位架构的ABI" class="headerlink" title="ARM 64位架构的ABI"></a>ARM 64位架构的ABI</h2><p>ARM体系结构的应用程序二进制接口（<code>ABI</code>， Application Binary Interface）指定了基本规则所有可执行的本机代码模块必须遵守，以便它们可以正常工作。</p><h3 id="通用寄存器"><a href="#通用寄存器" class="headerlink" title="通用寄存器"></a>通用寄存器</h3><p>通用寄存器分为4组：</p><p><img src="/images/2019/02/armv8_register.png" alt="armv8-register"></p><ul><li><p>参数寄存器<code>（X0-X7）</code>： 用作临时寄存器或可以保存的调用者保存的寄存器变量函数内的中间值，调用其他函数之间的值（8个寄存器可用于传递参数）</p></li><li><p>来电保存的临时寄存器<code>（X9-X15）</code>： 如果调用者要求在任何这些寄存器中保留值调用另一个函数，调用者必须将受影响的寄存器保存在自己的堆栈中帧。 它们可以通过被调用的子程序进行修改，而无需保存并在返回调用者之前恢复它们。</p></li><li><p>被调用者保存的寄存器<code>（X19-X29）</code>： 这些寄存器保存在被调用者帧中。 它们可以被被调用者修改子程序，只要它们在返回之前保存并恢复。</p></li><li><p>特殊用途寄存器<code>（X8，X16-X18，X29，X30）</code>：</p><ul><li><code>X8</code>： 是间接结果寄存器。 用于传递地址的位置间接结果</li><li><code>X16</code>和<code>X17</code>： 程序内调用临时寄存器</li><li><code>X18</code>： 平台寄存器，保留用于平台ABI</li><li><code>X29</code>： 帧指针寄存器（FP）</li><li><code>X30</code>： 链接寄存器（LR）</li></ul></li></ul><h3 id="NEON和浮点寄存器"><a href="#NEON和浮点寄存器" class="headerlink" title="NEON和浮点寄存器"></a>NEON和浮点寄存器</h3><p><img src="/images/2019/02/armv8_simd_reg.png" alt="armv8-simd-reg"></p><h2 id="A64指令集"><a href="#A64指令集" class="headerlink" title="A64指令集"></a>A64指令集</h2><h3 id="A64特点"><a href="#A64特点" class="headerlink" title="A64特点"></a>A64特点</h3><ul><li>移除了批量加载寄存器指令 LDM/STM, PUSH/POP, 使用STP/LDP 一对加载寄存器指令代替；</li><li>没有提供访问CPSR的单一寄存器，但是提供访问PSTATE的状态域寄存器；</li><li>A64没有协处理器的概念，没有协处理器指令MCR,MRC；</li><li>相比A32少了很多条件执行指令，只有条件跳转和少数数据处理这类指令才有条件执行.附件为条件指令码；</li></ul><h3 id="指令格式"><a href="#指令格式" class="headerlink" title="指令格式"></a>指令格式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Opcode&gt;&#123;&lt;Cond&gt;&#125;&lt;S&gt;  &lt;Rd&gt;, &lt;Rn&gt; &#123;,&lt;Opcode2&gt;&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li><code>Opcode</code>：操作码，也就是助记符，说明指令需要执行的操作类型</li><li><code>Cond</code>：指令执行条件码，查看附件图；</li><li><code>S</code>：条件码设置项,决定本次指令执行是否影响PSTATE寄存器响应状态位值</li><li><code>Rd/Xt</code>：目标寄存器，A32指令可以选择R0-R14,T32指令大部分只能选择RO-R7，A64指令可以选择X0-X30；</li><li><code>Rn/Xn</code>：第一个操作数的寄存器，和Rd一样，不同指令有不同要求；</li><li><code>Opcode2</code>：第二个操作数，可以是立即数，寄存器Rm和寄存器移位方式（Rm，#shit）；</li></ul></blockquote><h3 id="内存访问指令"><a href="#内存访问指令" class="headerlink" title="内存访问指令"></a>内存访问指令</h3><ul><li>加载指令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LDR Rt, &lt;addr&gt;</span><br></pre></td></tr></table></figure></li></ul><blockquote><ul><li><code>LDRB</code> (8-bit, zero extended).</li><li><code>LDRSB</code> (8-bit, sign extended).</li><li><code>LDRH</code> (16-bit, zero extended).</li><li><code>LDRSH</code> (16-bit, sign extended).</li><li><code>LDRSW</code> (32-bit, sign extended).</li></ul></blockquote><p><img src="/images/2019/02/armv8加载指令的地址偏移.png" alt="armv8加载指令的地址偏移"></p><ul><li>存储指令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STR Rn, &lt;addr&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="/downloads/arm/DEN0024A_v8_architecture_PG.pdf">Programmer’s Guide for ARMv8-A</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/2019/02/armv8_a.png&quot; alt=&quot;armv8-a&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ARM" scheme="http://winddoing.github.io/categories/ARM/"/>
    
    
      <category term="ARM" scheme="http://winddoing.github.io/tags/ARM/"/>
    
  </entry>
  
  <entry>
    <title>性能优化---指令预取</title>
    <link href="http://winddoing.github.io/post/35506.html"/>
    <id>http://winddoing.github.io/post/35506.html</id>
    <published>2019-02-25T07:34:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p><strong>指令预取</strong>: 是指提前将所需要的数据取出来，在使用时可用。</p><blockquote><p>具体方法就是在不命中时，当数据从主存储器中取出送往CPU的同时，把主存储器相邻几个单元中的数据（称为一个数据块）都取出来送入Cache中。</p></blockquote><p>CPU在cache不命中的情况下，将从内存读取一个连续的cacheline大小数据。</p><ul><li>如果访问数据地址连续，CPU产生Cache不命中的情况少，省时</li><li>如果访问数据地址不连续，CPU产生的Cache不命中的情况多，耗时</li></ul><a id="more"></a><h2 id="示例–矩阵乘法"><a href="#示例–矩阵乘法" class="headerlink" title="示例–矩阵乘法"></a>示例–矩阵乘法</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> __aarch64__</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">define</span> nop asm(<span class="meta-string">"nop"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">define</span> nop</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> i, j, k;</span><br><span class="line">    <span class="keyword">int</span> N = <span class="number">700</span>;</span><br><span class="line">    <span class="keyword">int</span> res[N][N], mul1[N][N], mul2[N][N];</span><br><span class="line">    <span class="keyword">clock_t</span> start, end;</span><br><span class="line">    <span class="keyword">long</span> time1 = <span class="number">0</span>, time2 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; N; ++j) &#123;</span><br><span class="line">            mul1[i][j] = (i + <span class="number">1</span>) * j;</span><br><span class="line">            mul2[i][j] = i * j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    start = clock();</span><br><span class="line">    <span class="comment">/* mul2的地址空间不是连续的</span></span><br><span class="line"><span class="comment">     * 初始化时mul2[0][x], 一行一行赋值，地址连续</span></span><br><span class="line"><span class="comment">     * 执行读取mul2[x][0], 一列一列读取，地址不连续*/</span></span><br><span class="line">    nop;nop;nop;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; N; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; N; ++k) &#123;</span><br><span class="line">                <span class="comment">// 行 x 列</span></span><br><span class="line">                res[i][j] += mul1[i][k] * mul2[k][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    nop;nop;nop;</span><br><span class="line">    end = clock();</span><br><span class="line">    time1 = end - start;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Run Time1 %f s\n"</span>, (<span class="keyword">double</span>)time1 / CLOCKS_PER_SEC);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> tmp[N][N];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; N; ++j) &#123;</span><br><span class="line">            mul1[i][j] = (i + <span class="number">1</span>) * j;</span><br><span class="line">            mul2[i][j] = i * j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    start = clock();</span><br><span class="line">    <span class="comment">// 矩阵转换，列变换（列变行）</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; N; ++j) &#123;</span><br><span class="line">            tmp[i][j] = mul2[j][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* CPU读取连续的tmp地址时，使用指令预取（硬件）</span></span><br><span class="line"><span class="comment">     * DCache 命中效率*/</span></span><br><span class="line">    nop;nop;nop;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; N; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; N; ++k) &#123;</span><br><span class="line">                res[i][j] += mul1[i][k] * tmp[j][k];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    nop;nop;nop;</span><br><span class="line">    end = clock();</span><br><span class="line">    time2 = end - start;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Run Time2 %f s\n"</span>, (<span class="keyword">double</span>)time2 / CLOCKS_PER_SEC);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Time2 and Time1 upgrade %f %\n"</span>, (<span class="keyword">double</span>)(time1 - time2) / time1 * <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>结果–arm平台</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[shell@localhost:/]$ ./prefetch</span><br><span class="line">Run Time1 5.966075 s</span><br><span class="line">Run Time2 4.530201 s</span><br><span class="line">Time2 and Time1 upgrade 24.067314 %</span><br></pre></td></tr></table></figure><blockquote><p>代码运行速度提升<code>24%</code></p></blockquote><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ul><li>Cache命中率</li><li>乘法运算与赋值运算的效率</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;指令预取&lt;/strong&gt;: 是指提前将所需要的数据取出来，在使用时可用。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;具体方法就是在不命中时，当数据从主存储器中取出送往CPU的同时，把主存储器相邻几个单元中的数据（称为一个数据块）都取出来送入Cache中。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;CPU在cache不命中的情况下，将从内存读取一个连续的cacheline大小数据。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果访问数据地址连续，CPU产生Cache不命中的情况少，省时&lt;/li&gt;
&lt;li&gt;如果访问数据地址不连续，CPU产生的Cache不命中的情况多，耗时&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="程序设计" scheme="http://winddoing.github.io/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="性能" scheme="http://winddoing.github.io/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E6%80%A7%E8%83%BD/"/>
    
    
      <category term="指令" scheme="http://winddoing.github.io/tags/%E6%8C%87%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>数据压缩算法---霍夫曼编码（Huffman）</title>
    <link href="http://winddoing.github.io/post/3506.html"/>
    <id>http://winddoing.github.io/post/3506.html</id>
    <published>2019-02-23T07:34:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>霍夫曼编码是一种基于<code>最小冗余编码</code>的压缩算法。最小冗余编码是指，如果知道一组数据中符号出现的频率，就可以用一种特殊的方式来表示符号从而减少数据需要的存储空间。</p><ul><li>用较少的位对出现频率高的符号编码</li><li>用较多的位对出现频率低的符号编码</li></ul><p>一个符号不一定必须是文本字符，它可以是任何大小的数据，但往往它只占一个字节。</p><blockquote><p>Huffman Coding：译为哈夫曼编码、赫夫曼编码、霍夫曼编码。 是<code>可变字长编码(VLC)</code>的一种。用于<code>无损数据压缩</code>的<code>熵编码（权编码）</code>算法，是一种通过字符出现频率，根据二叉树实现。</p></blockquote><a id="more"></a><h2 id="编码示例"><a href="#编码示例" class="headerlink" title="编码示例"></a>编码示例</h2><h3 id="编码字符统计"><a href="#编码字符统计" class="headerlink" title="编码字符统计"></a>编码字符统计</h3><table><thead><tr><th style="text-align:center">符号</th><th style="text-align:center">概率</th><th style="text-align:center">每个实例的熵</th></tr></thead><tbody><tr><td style="text-align:center">U</td><td style="text-align:center">12/72</td><td style="text-align:center">2.584 963</td></tr><tr><td style="text-align:center">V</td><td style="text-align:center">18/72</td><td style="text-align:center">2.000 000</td></tr><tr><td style="text-align:center">W</td><td style="text-align:center">7/72</td><td style="text-align:center">3.362 570</td></tr><tr><td style="text-align:center">X</td><td style="text-align:center">15/72</td><td style="text-align:center">2.263 034</td></tr><tr><td style="text-align:center">Y</td><td style="text-align:center">20/72</td><td style="text-align:center">1.847 997</td></tr></tbody></table><h4 id="熵和最小冗余"><a href="#熵和最小冗余" class="headerlink" title="熵和最小冗余"></a>熵和最小冗余</h4><p>每个数据集都有一定的信息量，这就是所谓的熵。一组数据的熵是数据中每个符号熵的总和<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sz = -lg2 Pz</span><br></pre></td></tr></table></figure></p><blockquote><p><code>Pz</code> 就数据集中z出现的频率</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Su = -lg2(12/72) = 2.584 963位</span><br></pre></td></tr></table></figure><blockquote><p>72个字符的字符串中，U字符最少可以使用3位表示（四舍五入）</p></blockquote><h3 id="构造霍夫曼树"><a href="#构造霍夫曼树" class="headerlink" title="构造霍夫曼树"></a>构造霍夫曼树</h3><p><img src="/images/2019/02/huffman_tree.png" alt="huffman_tree"></p><p><strong>出现频率越多的会越在上层，编码也越短，出现频率越少的就越在下层，编码也越长</strong></p><blockquote><p>用霍夫曼树压缩数据，给定一个具体的符号，从树的根开始，然后沿着树的叶向叶子结点追踪。在向下追踪的过程中.</p><ul><li>当向左分支移动时，向当前编码的末尾追加<code>0</code>；</li><li>当向右分支移动时，向当前编码的末尾追加<code>1</code></li></ul></blockquote><h3 id="编码表"><a href="#编码表" class="headerlink" title="编码表"></a>编码表</h3><table><thead><tr><th style="text-align:center">字符</th><th style="text-align:center">编码</th></tr></thead><tbody><tr><td style="text-align:center">U</td><td style="text-align:center">‘101’</td></tr><tr><td style="text-align:center">V</td><td style="text-align:center">‘01’</td></tr><tr><td style="text-align:center">W</td><td style="text-align:center">‘100’</td></tr><tr><td style="text-align:center">X</td><td style="text-align:center">‘00’</td></tr><tr><td style="text-align:center">Y</td><td style="text-align:center">‘11’</td></tr></tbody></table><h3 id="编码效率"><a href="#编码效率" class="headerlink" title="编码效率"></a>编码效率</h3><ul><li>不压缩数据大小：72*8=576bit</li><li><p>压缩后数据大小：12<em>3+18</em>2+7<em>3+15</em>2+20*2=163bit</p></li><li><p><strong>压缩比</strong>：1 - 163/576 = 71.7%</p></li></ul><p>在通常情况下，霍夫曼编码并不是最高效的压缩方法，但它压缩和解压缩的速度非常快。</p><ul><li>一般来说，造成霍夫曼编码比较耗时的原因是它需要<code>扫描两次数据</code>：一次用来计算频率；另一次才是用来压缩数据。</li><li>而解压缩数据非常高效，因为解码每个符号的序列只需要扫描一次霍夫曼树。</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="http://blog.jobbole.com/20091/" target="_blank" rel="noopener">霍夫曼编码压缩算法</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;霍夫曼编码是一种基于&lt;code&gt;最小冗余编码&lt;/code&gt;的压缩算法。最小冗余编码是指，如果知道一组数据中符号出现的频率，就可以用一种特殊的方式来表示符号从而减少数据需要的存储空间。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用较少的位对出现频率高的符号编码&lt;/li&gt;
&lt;li&gt;用较多的位对出现频率低的符号编码&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一个符号不一定必须是文本字符，它可以是任何大小的数据，但往往它只占一个字节。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Huffman Coding：译为哈夫曼编码、赫夫曼编码、霍夫曼编码。 是&lt;code&gt;可变字长编码(VLC)&lt;/code&gt;的一种。用于&lt;code&gt;无损数据压缩&lt;/code&gt;的&lt;code&gt;熵编码（权编码）&lt;/code&gt;算法，是一种通过字符出现频率，根据二叉树实现。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="多媒体" scheme="http://winddoing.github.io/categories/%E5%A4%9A%E5%AA%92%E4%BD%93/"/>
    
      <category term="编码" scheme="http://winddoing.github.io/categories/%E5%A4%9A%E5%AA%92%E4%BD%93/%E7%BC%96%E7%A0%81/"/>
    
    
      <category term="Huffman" scheme="http://winddoing.github.io/tags/Huffman/"/>
    
  </entry>
  
  <entry>
    <title> H264码流格式</title>
    <link href="http://winddoing.github.io/post/35564.html"/>
    <id>http://winddoing.github.io/post/35564.html</id>
    <published>2019-02-20T07:46:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>H264的两种码流格式，它们分别为：<code>字节流格式</code>和<code>RTP包格式</code>。</p><ul><li><code>字节流格式</code>: 默认的输出格式。它的基本数据单位为NAL单元，也即NALU。为了从字节流中提取出NALU，协议规定，在每个NALU的前面加上起始码：0x000001或0x00000001（0x代表十六进制）</li><li>RTP包格式: 一种数据传输格式,主要用于网络传送</li></ul><blockquote><p>字节流格式,由于它没有经过传输协议封装，所以也可以称之为<code>裸流</code></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">H264比特流 = Start_Code_Prefix + NALU + Start_Code_Prefix + NALU + ...</span><br></pre></td></tr></table></figure><a id="more"></a><p><img src="/images/2019/02/h264_struct.png" alt="H264_struct"></p><h2 id="起始码与NALU"><a href="#起始码与NALU" class="headerlink" title="起始码与NALU"></a>起始码与NALU</h2><blockquote><p>起始码（Start_Code_Prefix）: <code>0x00 00 01</code>或<code>0x00 00 00 01</code></p></blockquote><p>在两个起始码之间的数据，称为<code>NALU</code></p><h2 id="NALU"><a href="#NALU" class="headerlink" title="NALU"></a>NALU</h2><blockquote><p>NAL Unit: Network Abstract Layer Unit</p></blockquote><p>每个NAL单元包括一个原始字节序列负荷(RBSP, Raw Byte Sequence Payload)、一组对应于视频编码的NAL头信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NALU = NALU Header + RBSP</span><br></pre></td></tr></table></figure><blockquote><ul><li><code>SODB</code>:(String of Data Bits)最原始的编码数据，无任何附加数据。</li><li><code>RBSP</code>:在SODB的基础上增加了rbsp_stop_ont_bit(bit值为1)并用0按字节补位对齐。</li><li><code>EBSP</code>:(Encapsulation Byte Sequence Packets)在RBSP的基础上增加了防止伪起始码字节(0x03)。</li></ul></blockquote><h3 id="NALU-Header"><a href="#NALU-Header" class="headerlink" title="NALU Header"></a>NALU Header</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAL Header： forbidden_bit， nal_reference_bit（优先级）， nal_unit_type（类型）</span><br><span class="line">                  1bit            2bit                        5bit</span><br></pre></td></tr></table></figure><h2 id="Slice"><a href="#Slice" class="headerlink" title="Slice"></a>Slice</h2><p>一个视频图像可编码成一个或更多个条带，每个条带包含整数个宏块（MB），即每个条带至少一个MB，最多时每个条带包含整个图像的宏块。总之，一幅图像中每个条带的宏块数不一定固定。设条带的目的是为了限制误码的扩散和传输，应使编码条带相互间是独立的。某个条带的预测不能以其它条带中的宏块为参考图像，这样某一条带中的预测误差才不会传播到其它条带中去。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://blog.csdn.net/wh8_2011/article/details/51163368" target="_blank" rel="noopener">H.264的Slice及Slice类型</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;H264的两种码流格式，它们分别为：&lt;code&gt;字节流格式&lt;/code&gt;和&lt;code&gt;RTP包格式&lt;/code&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;字节流格式&lt;/code&gt;: 默认的输出格式。它的基本数据单位为NAL单元，也即NALU。为了从字节流中提取出NALU，协议规定，在每个NALU的前面加上起始码：0x000001或0x00000001（0x代表十六进制）&lt;/li&gt;
&lt;li&gt;RTP包格式: 一种数据传输格式,主要用于网络传送&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;字节流格式,由于它没有经过传输协议封装，所以也可以称之为&lt;code&gt;裸流&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;H264比特流 = Start_Code_Prefix + NALU + Start_Code_Prefix + NALU + ...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="多媒体" scheme="http://winddoing.github.io/categories/%E5%A4%9A%E5%AA%92%E4%BD%93/"/>
    
      <category term="视频" scheme="http://winddoing.github.io/categories/%E5%A4%9A%E5%AA%92%E4%BD%93/%E8%A7%86%E9%A2%91/"/>
    
    
      <category term="H264" scheme="http://winddoing.github.io/tags/H264/"/>
    
  </entry>
  
  <entry>
    <title>Linux下GBK文件编码批量转换UTF-8</title>
    <link href="http://winddoing.github.io/post/38869.html"/>
    <id>http://winddoing.github.io/post/38869.html</id>
    <published>2019-02-18T11:46:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>Windows默认是<code>GBK</code>编码格式，Linux默认是<code>UTF-8</code>的格式，不同格式之间的乱码处理。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enca -L zh_CN -x UTF-8 *.c</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="enca-–-文件编码"><a href="#enca-–-文件编码" class="headerlink" title="enca – 文件编码"></a>enca – 文件编码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">enca -h</span></span><br><span class="line">Usage:  enca [-L LANGUAGE] [OPTION]... [FILE]...</span><br><span class="line">        enconv [-L LANGUAGE] [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure><p>用法：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> enca -L zh_CN file      检查文件的编码</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> enca -L zh_CN -x UTF-8 file 将文件编码转换为<span class="string">"UTF-8"</span>编码</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> enca -L zh_CN -x UTF-8 file1 file2 如果不想覆盖原文件可以这样</span></span><br></pre></td></tr></table></figure></p><h2 id="convmv-–-文件名编码"><a href="#convmv-–-文件名编码" class="headerlink" title="convmv – 文件名编码"></a>convmv – 文件名编码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> convmv -f 源编码 -t 新编码 [选项] 文件名</span></span><br></pre></td></tr></table></figure><blockquote><ul><li>-r 递归处理子文件夹</li><li>–notest 真正进行操作，请注意在默认情况下是不对文件进行真实操作的，而只是试验。</li><li>–list 显示所有支持的编码</li><li>–unescap 可以做一下转义，比如把%20变成空格</li></ul></blockquote><p>示例：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> convmv -f GBK -t UTF-8 --notest utf8 filename</span></span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> find default -<span class="built_in">type</span> f -<span class="built_in">exec</span> convmv -f GBK -t UTF-8 --notest utf8 &#123;&#125; -o utf/&#123;&#125; \;</span></span><br></pre></td></tr></table></figure><blockquote><p>批量处理</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Windows默认是&lt;code&gt;GBK&lt;/code&gt;编码格式，Linux默认是&lt;code&gt;UTF-8&lt;/code&gt;的格式，不同格式之间的乱码处理。&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;enca -L zh_CN -x UTF-8 *.c&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="shell" scheme="http://winddoing.github.io/categories/shell/"/>
    
    
      <category term="Shell" scheme="http://winddoing.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux系统应用层的内存申请--memory</title>
    <link href="http://winddoing.github.io/post/9412.html"/>
    <id>http://winddoing.github.io/post/9412.html</id>
    <published>2019-01-25T01:51:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>在linux系统编程中常见的内存申请方式和其特性，<code>malloc</code>，<code>calloc</code>, <code>realloc</code></p><a id="more"></a><h2 id="malloc"><a href="#malloc" class="headerlink" title="malloc"></a>malloc</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> *<span class="title">malloc</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> num_bytes)</span></span>;</span><br></pre></td></tr></table></figure><blockquote><ul><li>功能： 分配长度为num_bytes字节的内存块</li><li>返回值： 如果分配成功则返回指向被分配内存的指针(此存储区中的<code>初始值不确定</code>)，否则返回空指针NULL。</li></ul></blockquote><p>函数的工作机制</p><p>malloc函数的实质体现在，它有一个将可用的内存块连接为一个长长的列表的所谓空闲链表。调用malloc函数时，它沿连接表寻找一个大到足以满足用户请求所需要的内存块。然后，将该内存块一分为二（一块的大小与用户请求的大小相等，另一块的大小就是剩下的字节）。接下来，将分配给用户的那块内存传给用户，并将剩下的那块（如果有的话）返回到连接表上。</p><p>调用free函数时，它将用户释放的内存块连接到空闲链上。到最后，空闲链会被切成很多的小内存片段，如果这时用户申请一个大的内存片段，那么空闲链上可能没有可以满足用户要求的片段了。于是，malloc函数请求延时，并开始在空闲链上翻箱倒柜地检查各内存片段，对它们进行整理，将相邻的小空闲块合并成较大的内存块。如果无法获得符合要求的内存块，malloc函数会返回NULL指针，因此在调用malloc动态申请内存块时，一定要进行返回值的判断。</p><p>Linux Libc6采用的机制是在free的时候试图整合相邻的碎片，使其合并成为一个较大的free空间。</p><h2 id="calloc"><a href="#calloc" class="headerlink" title="calloc"></a>calloc</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void *calloc(unsigned n,unsigned size)；</span><br></pre></td></tr></table></figure><blockquote><ul><li>功能： 在内存的动态存储区中分配n个长度为size的内存空间，并初始化为<code>0</code></li><li>返回值： 函数返回一个指向分配起始地址的指针；如果分配不成功，返回NULL。</li></ul></blockquote><h3 id="malloc的区别"><a href="#malloc的区别" class="headerlink" title="malloc的区别"></a>malloc的区别</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ansidecl.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stddef.h&gt;</span></span></span><br><span class="line"><span class="comment">/* For systems with larger pointers than ints, this must be declared.  */</span></span><br><span class="line"><span class="function">PTR <span class="title">malloc</span> <span class="params">(<span class="keyword">size_t</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bzero</span> <span class="params">(PTR, <span class="keyword">size_t</span>)</span></span>;</span><br><span class="line">PTR</span><br><span class="line"><span class="built_in">calloc</span> (<span class="keyword">size_t</span> nelem, <span class="keyword">size_t</span> elsize)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">register</span> PTR ptr;  </span><br><span class="line">  <span class="keyword">if</span> (nelem == <span class="number">0</span> || elsize == <span class="number">0</span>)</span><br><span class="line">    nelem = elsize = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  ptr = <span class="built_in">malloc</span> (nelem * elsize);</span><br><span class="line">  <span class="keyword">if</span> (ptr) bzero (ptr, nelem * elsize);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ptr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://code.woboq.org/gcc/libiberty/calloc.c.html" target="_blank" rel="noopener">https://code.woboq.org/gcc/libiberty/calloc.c.html</a></p></blockquote><p>只多做了初始化清零的操作<code>bzero</code></p><h2 id="realloc"><a href="#realloc" class="headerlink" title="realloc"></a>realloc</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> *<span class="title">realloc</span><span class="params">(<span class="keyword">void</span> *mem_address, <span class="keyword">unsigned</span> <span class="keyword">int</span> newsize)</span></span>;</span><br></pre></td></tr></table></figure><blockquote><ul><li>功能： 先判断当前的指针是否有足够的连续空间，如果有，扩大mem_address指向的地址，并且将mem_address返回，如果空间不够，先按照newsize指定的大小分配空间，将原有数据从头到尾拷贝到新分配的内存区域，而后释放原来mem_address所指内存区域，同时返回新分配的内存区域的首地址。即重新分配存储器块的地址。</li><li>返回值： 如果重新分配成功则返回指向被分配内存的指针，否则返回空指针NULL</li></ul></blockquote><p><strong>注意</strong>：这里原始内存中的数据还是保持不变的。当内存不再使用时，应使用free()函数将内存块释放。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在linux系统编程中常见的内存申请方式和其特性，&lt;code&gt;malloc&lt;/code&gt;，&lt;code&gt;calloc&lt;/code&gt;, &lt;code&gt;realloc&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="程序设计" scheme="http://winddoing.github.io/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    
      <category term="内存" scheme="http://winddoing.github.io/tags/%E5%86%85%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>Linux性能测试工具---Lmbench</title>
    <link href="http://winddoing.github.io/post/54953.html"/>
    <id>http://winddoing.github.io/post/54953.html</id>
    <published>2019-01-19T06:37:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>Lmbench是一套简易，可移植的，符合ANSI/C标准为UNIX/POSIX而制定的微型测评工具。一般来说，它衡量两个关键特征：<code>反应时间</code>和<code>带宽</code>。Lmbench旨在使系统开发者深入了解关键操作的基础成本。</p><blockquote><p>测试包括文档读写、内存操作、进程创建销毁开销、网络等性能，测试方法简单</p><p>Lmbench: <a href="http://www.bitmover.com/lmbench/" target="_blank" rel="noopener">http://www.bitmover.com/lmbench</a></p></blockquote><table><thead><tr><th style="text-align:center">带宽测评(<code>bw_*</code>)</th><th style="text-align:center">&lt;命令&gt;</th><th style="text-align:center">反应时间测评（<code>lat_*</code>）</th><th style="text-align:center">&lt;命令&gt;</th></tr></thead><tbody><tr><td style="text-align:center">读取缓存文件</td><td style="text-align:center">bw_file_rd</td><td style="text-align:center">上下文切换</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">拷贝内存</td><td style="text-align:center">bw_mem 1M cp</td><td style="text-align:center">网络： 连接的建立，管道，TCP，UDP和RPC hot potato</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">读内存</td><td style="text-align:center">bw_mem 1M rd</td><td style="text-align:center">文件系统的建立和删除</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">写内存</td><td style="text-align:center">bw_mem 1M wr</td><td style="text-align:center">进程创建</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">管道</td><td style="text-align:center">bw_pipe</td><td style="text-align:center">信号处理</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">TCP</td><td style="text-align:center">bw_tcp</td><td style="text-align:center">上层的系统调用</td><td style="text-align:center">-</td></tr><tr><td style="text-align:center">-</td><td style="text-align:center">-</td><td style="text-align:center">内存读入反应时间</td><td style="text-align:center">lat_mem_rd</td></tr></tbody></table><blockquote><p><code>man</code>获取详细信息</p></blockquote><a id="more"></a><p>移植方便可在buildroot配置</p><h2 id="mhz"><a href="#mhz" class="headerlink" title="mhz"></a>mhz</h2><p>计算处理时钟</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> mhz</span></span><br><span class="line">1290 MHz, 0.7752 nanosec clock</span><br></pre></td></tr></table></figure><h2 id="tlb"><a href="#tlb" class="headerlink" title="tlb"></a>tlb</h2><p>获取TLB大小</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tlb</span></span><br><span class="line">tlb: 10 pages</span><br></pre></td></tr></table></figure><h2 id="line"><a href="#line" class="headerlink" title="line"></a>line</h2><p>Cache line大小</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> line</span></span><br><span class="line">64</span><br></pre></td></tr></table></figure><h2 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h2><p>测试内存带宽</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> stream</span></span><br><span class="line">STREAM copy latency: 4.98 nanoseconds</span><br><span class="line">STREAM copy bandwidth: 3213.50 MB/sec</span><br><span class="line">STREAM scale latency: 6.71 nanoseconds</span><br><span class="line">STREAM scale bandwidth: 2385.57 MB/sec</span><br><span class="line">STREAM add latency: 10.64 nanoseconds</span><br><span class="line">STREAM add bandwidth: 2256.06 MB/sec</span><br><span class="line">STREAM triad latency: 12.45 nanoseconds</span><br><span class="line">STREAM triad bandwidth: 1927.25 MB/sec</span><br></pre></td></tr></table></figure><h2 id="lmdd"><a href="#lmdd" class="headerlink" title="lmdd"></a>lmdd</h2><p>移动io进行性能和调试测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> time lmdd <span class="keyword">if</span>=/dev/urandom of=/tmp/xxx bs=1M count=10</span></span><br><span class="line">10.0000 MB in 1.7651 secs, 5.6653 MB/sec  #速度</span><br><span class="line">real    0m 1.77s</span><br><span class="line">user    0m 0.00s</span><br><span class="line">sys     0m 1.77s</span><br></pre></td></tr></table></figure><h2 id="测试示例"><a href="#测试示例" class="headerlink" title="测试示例"></a>测试示例</h2><h3 id="拷贝内存"><a href="#拷贝内存" class="headerlink" title="拷贝内存"></a>拷贝内存</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> bw_mem 500M cp</span></span><br><span class="line">500.00 858.05   #500M测试数据，拷贝速度858.05MB/s</span><br></pre></td></tr></table></figure><h3 id="内存写入反应时间"><a href="#内存写入反应时间" class="headerlink" title="内存写入反应时间"></a>内存写入反应时间</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> lat_mem_rd 1M</span></span><br><span class="line">"stride=64     #步长，</span><br><span class="line">0.00049 2.343  #写入大小，反应时间纳秒（ns）</span><br><span class="line">0.00098 2.343</span><br><span class="line">0.00195 2.343</span><br><span class="line">0.00293 2.343</span><br><span class="line">^C</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Lmbench是一套简易，可移植的，符合ANSI/C标准为UNIX/POSIX而制定的微型测评工具。一般来说，它衡量两个关键特征：&lt;code&gt;反应时间&lt;/code&gt;和&lt;code&gt;带宽&lt;/code&gt;。Lmbench旨在使系统开发者深入了解关键操作的基础成本。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;测试包括文档读写、内存操作、进程创建销毁开销、网络等性能，测试方法简单&lt;/p&gt;
&lt;p&gt;Lmbench: &lt;a href=&quot;http://www.bitmover.com/lmbench/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.bitmover.com/lmbench&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;带宽测评(&lt;code&gt;bw_*&lt;/code&gt;)&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;&amp;lt;命令&amp;gt;&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;反应时间测评（&lt;code&gt;lat_*&lt;/code&gt;）&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;&amp;lt;命令&amp;gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;读取缓存文件&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;bw_file_rd&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;上下文切换&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;拷贝内存&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;bw_mem 1M cp&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;网络： 连接的建立，管道，TCP，UDP和RPC hot potato&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;读内存&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;bw_mem 1M rd&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;文件系统的建立和删除&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;写内存&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;bw_mem 1M wr&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;进程创建&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;管道&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;bw_pipe&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;信号处理&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;TCP&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;bw_tcp&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;上层的系统调用&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;-&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;-&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;内存读入反应时间&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;lat_mem_rd&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;man&lt;/code&gt;获取详细信息&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="工具" scheme="http://winddoing.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="性能测试" scheme="http://winddoing.github.io/categories/%E5%B7%A5%E5%85%B7/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="Lmbench" scheme="http://winddoing.github.io/tags/Lmbench/"/>
    
  </entry>
  
  <entry>
    <title>proc文件系统解析--进程</title>
    <link href="http://winddoing.github.io/post/30680.html"/>
    <id>http://winddoing.github.io/post/30680.html</id>
    <published>2019-01-15T06:47:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>Linux系统上的/proc目录是一种文件系统，即proc文件系统。与其它常见的文件系统不同的是，/proc是一种伪文件系统（也即虚拟文件系统），存储的是当前内核运行状态的一系列特殊文件，用户可以通过这些文件查看有关系统硬件及当前正在运行进程的信息，甚至可以通过更改其中某些文件来改变内核的运行状态。</p><blockquote><p>所有说明均可通过<code>man proc</code>获取</p></blockquote><a id="more"></a><p>系统环境：<code>arm64bit</code>， <code>Linux4.4.70</code></p><h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><ul><li>测试进程<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ps</span></span><br><span class="line">...</span><br><span class="line">570 root      2728 S    top</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ls -ls</span></span><br><span class="line">    0 dr-xr-xr-x    2 root     root             0 Jan  1 04:14 attr</span><br><span class="line">    0 -r--------    1 root     root             0 Jan  1 04:14 auxv</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 cgroup</span><br><span class="line">    0 --w-------    1 root     root             0 Jan  1 04:14 clear_refs</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 03:31 cmdline</span><br><span class="line">    0 -rw-r--r--    1 root     root             0 Jan  1 04:14 comm</span><br><span class="line">    0 -rw-r--r--    1 root     root             0 Jan  1 04:14 coredump_filter</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 cpuset</span><br><span class="line">    0 lrwxrwxrwx    1 root     root             0 Jan  1 04:14 cwd -&gt; /proc</span><br><span class="line">    0 -r--------    1 root     root             0 Jan  1 04:14 environ</span><br><span class="line">    0 lrwxrwxrwx    1 root     root             0 Jan  1 04:14 exe -&gt; /bin/busybox</span><br><span class="line">    0 dr-x------    2 root     root             0 Jan  1 04:14 fd</span><br><span class="line">    0 dr-x------    2 root     root             0 Jan  1 04:14 fdinfo</span><br><span class="line">    0 -rw-r--r--    1 root     root             0 Jan  1 04:14 gid_map</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 limits</span><br><span class="line">    0 dr-x------    2 root     root             0 Jan  1 04:14 map_files</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 maps</span><br><span class="line">    0 -rw-------    1 root     root             0 Jan  1 04:14 mem</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 mountinfo</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 mounts</span><br><span class="line">    0 -r--------    1 root     root             0 Jan  1 04:14 mountstats</span><br><span class="line">    0 dr-xr-xr-x   10 root     root             0 Jan  1 04:14 net</span><br><span class="line">    0 dr-x--x--x    2 root     root             0 Jan  1 04:14 ns</span><br><span class="line">    0 -r--------    1 root     root             0 Jan  1 04:14 oom_adj</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 oom_score</span><br><span class="line">    0 -r--------    1 root     root             0 Jan  1 04:14 oom_score_adj</span><br><span class="line">    0 -r--------    1 root     root             0 Jan  1 04:14 pagemap</span><br><span class="line">    0 -r--------    1 root     root             0 Jan  1 04:14 personality</span><br><span class="line">    0 -rw-r--r--    1 root     root             0 Jan  1 04:14 projid_map</span><br><span class="line">    0 lrwxrwxrwx    1 root     root             0 Jan  1 04:14 root -&gt; /</span><br><span class="line">    0 -rw-r--r--    1 root     root             0 Jan  1 04:14 sched</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 schedstat</span><br><span class="line">    0 -rw-r--r--    1 root     root             0 Jan  1 04:14 setgroups</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 smaps</span><br><span class="line">    0 -r--------    1 root     root             0 Jan  1 04:14 stack</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 03:31 stat</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 statm</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 status</span><br><span class="line">    0 -r--------    1 root     root             0 Jan  1 04:14 syscall</span><br><span class="line">    0 dr-xr-xr-x    3 root     root             0 Jan  1 04:14 task</span><br><span class="line">    0 -rw-rw-rw-    1 root     root             0 Jan  1 04:14 timerslack_ns</span><br><span class="line">    0 -rw-r--r--    1 root     root             0 Jan  1 04:14 uid_map</span><br><span class="line">    0 -r--r--r--    1 root     root             0 Jan  1 04:14 wchan</span><br></pre></td></tr></table></figure><h2 id="进程目录"><a href="#进程目录" class="headerlink" title="进程目录"></a>进程目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ls /proc/570/</span></span><br><span class="line">attr             fd               ns               smaps</span><br><span class="line">auxv             fdinfo           oom_adj          stack</span><br><span class="line">cgroup           gid_map          oom_score        stat</span><br><span class="line">clear_refs       limits           oom_score_adj    statm</span><br><span class="line">cmdline          map_files        pagemap          status</span><br><span class="line">comm             maps             personality      syscall</span><br><span class="line">coredump_filter  mem              projid_map       task</span><br><span class="line">cpuset           mountinfo        root             timerslack_ns</span><br><span class="line">cwd              mounts           sched            uid_map</span><br><span class="line">environ          mountstats       schedstat        wchan</span><br><span class="line">exe              net              setgroups</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">选项</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:center">cmdline</td><td style="text-align:left">启动当前进程的完整命令，但僵尸进程目录中的此文件不包含任何信息</td></tr><tr><td style="text-align:center">cwd</td><td style="text-align:left">指向当前进程运行目录的一个符号链接</td></tr><tr><td style="text-align:center">exe</td><td style="text-align:left">指向启动当前进程的可执行文件（完整路径）的符号链接</td></tr><tr><td style="text-align:center">fd</td><td style="text-align:left">指向启动当前进程的可执行文件（完整路径）的符号链接</td></tr><tr><td style="text-align:center">limits</td><td style="text-align:left">当前进程所使用的每一个受限资源的软限制、硬限制和管理单元；此文件仅可由实际启动当前进程的UID用户读取；</td></tr><tr><td style="text-align:center">maps</td><td style="text-align:left">当前进程关联到的每个可执行文件和库文件在内存中的映射区域及其访问权限所组成的列表；</td></tr><tr><td style="text-align:center">mem</td><td style="text-align:left">当前进程所占用的内存空间，由open、read和lseek等系统调用使用，不能被用户读取；</td></tr><tr><td style="text-align:center">root</td><td style="text-align:left">指向当前进程运行根目录的符号链接；在Unix和Linux系统上，通常采用chroot命令使每个进程运行于独立的根目录；</td></tr><tr><td style="text-align:center">stat</td><td style="text-align:left">当前进程的状态信息，包含一系统格式化后的数据列，可读性差，通常由ps命令使用；</td></tr><tr><td style="text-align:center">statm</td><td style="text-align:left">当前进程占用内存的状态信息，通常以“页面”（page）表示；</td></tr><tr><td style="text-align:center">status</td><td style="text-align:left">与stat所提供信息类似，但可读性较好</td></tr><tr><td style="text-align:center">task</td><td style="text-align:left">包含由当前进程所运行的每一个线程的相关信息，每个<code>线程</code>的相关信息文件均保存在一个由线程号（tid）命名的目录中，这类似于其内容类似于每个进程目录中的内容</td></tr></tbody></table><h3 id="proc-PID-stat"><a href="#proc-PID-stat" class="headerlink" title="/proc/[PID]/stat"></a>/proc/[PID]/stat</h3><blockquote><p>包含了所有CPU活跃的信息，该文件中的所有值都是<code>从系统启动开始累计到当前时刻</code>。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">cat /proc/570/<span class="built_in">stat</span></span></span><br><span class="line">570 (top) S 565 570 565 34817 570 4210688 110 0 0 0 209 648 0 0 20 0 1 0 1266675 2793472 111 18446744073709551615 4194304 4867856 548828687344 548828686432 548186418324 0 0 0 58751527 1 0 0 17 3 0 0 0 0 0 4933392 4937189 1042927616 548828688219 548828688223 548828688223 548828688363 0</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">序号</th><th style="text-align:left">表示</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:left">pid=570</td><td style="text-align:left">进程(包括轻量级进程，即线程)号</td></tr><tr><td style="text-align:center">2</td><td style="text-align:left">comm=top</td><td style="text-align:left">应用程序或命令的名字</td></tr><tr><td style="text-align:center">3</td><td style="text-align:left">task_state=R</td><td style="text-align:left">任务的状态，R:runnign, S:sleeping (TASK_INTERRUPTIBLE), D:disk sleep (TASK_UNINTERRUPTIBLE), T: stopped, T:tracing stop,Z:zombie, X:dead</td></tr><tr><td style="text-align:center">4</td><td style="text-align:left">ppid=565</td><td style="text-align:left">父进程ID</td></tr><tr><td style="text-align:center">5</td><td style="text-align:left">pgid=570</td><td style="text-align:left">线程组ID</td></tr><tr><td style="text-align:center">6</td><td style="text-align:left">session=565</td><td style="text-align:left">该任务所在的会话组ID</td></tr><tr><td style="text-align:center">7</td><td style="text-align:left">tty_nr=34817</td><td style="text-align:left">该任务的tty终端的设备号</td></tr><tr><td style="text-align:center">8</td><td style="text-align:left">tpgid=570</td><td style="text-align:left">终端的进程组号，当前运行在该任务所在终端的前台任务(包括shell 应用程序)的PID。</td></tr><tr><td style="text-align:center">9</td><td style="text-align:left">task-&gt;flags=4210688</td><td style="text-align:left">进程标志位，查看该任务的特性</td></tr><tr><td style="text-align:center">10</td><td style="text-align:left">min_flt=110</td><td style="text-align:left">该任务不需要从硬盘拷数据而发生的缺页（次缺页）的次数</td></tr><tr><td style="text-align:center">11</td><td style="text-align:left">cmin_flt=0</td><td style="text-align:left">累计的该任务的所有的waited-for进程曾经发生的次缺页的次数目</td></tr><tr><td style="text-align:center">12</td><td style="text-align:left">maj_flt=0</td><td style="text-align:left">该任务需要从硬盘拷数据而发生的缺页（主缺页）的次数</td></tr><tr><td style="text-align:center">13</td><td style="text-align:left">cmaj_flt=0</td><td style="text-align:left">累计的该任务的所有的waited-for进程曾经发生的主缺页的次数目</td></tr><tr><td style="text-align:center">14</td><td style="text-align:left">utime=209</td><td style="text-align:left">该任务在用户态运行的时间，单位为jiffies</td></tr><tr><td style="text-align:center">15</td><td style="text-align:left">stime=648</td><td style="text-align:left">该任务在核心态运行的时间，单位为jiffies</td></tr><tr><td style="text-align:center">16</td><td style="text-align:left">cutime=0</td><td style="text-align:left">累计的该任务的所有的waited-for进程曾经在用户态运行的时间，单位为jiffies</td></tr><tr><td style="text-align:center">17</td><td style="text-align:left">cstime=0</td><td style="text-align:left">累计的该任务的所有的waited-for进程曾经在核心态运行的时间，单位为jiffies</td></tr><tr><td style="text-align:center">18</td><td style="text-align:left">priority=20</td><td style="text-align:left">任务的动态优先级</td></tr><tr><td style="text-align:center">19</td><td style="text-align:left">nice=0</td><td style="text-align:left">任务的静态优先级</td></tr><tr><td style="text-align:center">20</td><td style="text-align:left">num_threads=1</td><td style="text-align:left">该任务所在的线程组里线程的个数</td></tr><tr><td style="text-align:center">21</td><td style="text-align:left">it_real_value=0</td><td style="text-align:left">由于计时间隔导致的下一个 SIGALRM 发送进程的时延，以jiffy为单位.</td></tr><tr><td style="text-align:center">22</td><td style="text-align:left">start_time=1266675</td><td style="text-align:left">该任务启动的时间，单位为jiffies</td></tr><tr><td style="text-align:center">23</td><td style="text-align:left">vsize=2793472</td><td style="text-align:left">该任务的虚拟地址空间大小, 单位为page</td></tr><tr><td style="text-align:center">24</td><td style="text-align:left">rss=111</td><td style="text-align:left">该任务当前驻留物理地址空间的大小，单位为page</td></tr><tr><td style="text-align:center">25</td><td style="text-align:left">rlim=18446744073709551615</td><td style="text-align:left">该任务能驻留物理地址空间的最大值. 单位：byte</td></tr><tr><td style="text-align:center">26</td><td style="text-align:left">start_code=4194304</td><td style="text-align:left">该任务在虚拟地址空间的代码段的起始地址</td></tr><tr><td style="text-align:center">27</td><td style="text-align:left">end_code=4867856</td><td style="text-align:left">该任务在虚拟地址空间的代码段的结束地址</td></tr><tr><td style="text-align:center">28</td><td style="text-align:left">startstack=548828687344</td><td style="text-align:left">堆栈的起始地址（即底部）</td></tr><tr><td style="text-align:center">29</td><td style="text-align:left">kstkesp=548828686432</td><td style="text-align:left">esp(堆栈指针) 的当前值, 与在进程的内核堆栈页得到的一致</td></tr><tr><td style="text-align:center">30</td><td style="text-align:left">kstkeip=548186418324</td><td style="text-align:left">指向将要执行的指令的指针, EIP(指令指针)的当前值.</td></tr><tr><td style="text-align:center">31</td><td style="text-align:left">signal=0</td><td style="text-align:left">待处理信号的位图，记录发送给进程的普通信号</td></tr><tr><td style="text-align:center">32</td><td style="text-align:left">blocked=0</td><td style="text-align:left">阻塞信号的位图</td></tr><tr><td style="text-align:center">33</td><td style="text-align:left">sigignore=0</td><td style="text-align:left">忽略的信号的位图</td></tr><tr><td style="text-align:center">34</td><td style="text-align:left">sigcatch=58751527</td><td style="text-align:left">被俘获的信号的位图</td></tr><tr><td style="text-align:center">35</td><td style="text-align:left">wchan=1</td><td style="text-align:left">如果该进程是睡眠状态，该值给出调度的调用点</td></tr><tr><td style="text-align:center">36</td><td style="text-align:left">nswap=0</td><td style="text-align:left">交换的页数（未维护）</td></tr><tr><td style="text-align:center">37</td><td style="text-align:left">cnswap=0</td><td style="text-align:left">子进程的累积nswap（未维护）。</td></tr><tr><td style="text-align:center">38</td><td style="text-align:left">exit_signal=17</td><td style="text-align:left">该进程结束时，向父进程所发送的信号</td></tr><tr><td style="text-align:center">39</td><td style="text-align:left">task_cpu(task)=3</td><td style="text-align:left">运行在哪个CPU上</td></tr><tr><td style="text-align:center">40</td><td style="text-align:left">task_rt_priority=0</td><td style="text-align:left">实时进程的相对优先级别</td></tr><tr><td style="text-align:center">41</td><td style="text-align:left">task_policy=0</td><td style="text-align:left">进程的调度策略，0=非实时进程，1=FIFO实时进程；2=RR实时进程</td></tr><tr><td style="text-align:center">42</td><td style="text-align:left">delayacct_blkio_ticks=0</td><td style="text-align:left">聚合块I/O延迟，以时钟周期（厘秒,百分之一秒）为单位。</td></tr><tr><td style="text-align:center">43</td><td style="text-align:left">guest_time=0</td><td style="text-align:left">-</td></tr><tr><td style="text-align:center">44</td><td style="text-align:left">cguest_time=0</td><td style="text-align:left">-</td></tr><tr><td style="text-align:center">45</td><td style="text-align:left">start_data=4933392</td><td style="text-align:left">放置程序数据和未初始化（BSS）数据的地址。</td></tr><tr><td style="text-align:center">46</td><td style="text-align:left">end_data  =4937189</td><td style="text-align:left">-</td></tr><tr><td style="text-align:center">47</td><td style="text-align:left">start_brk=1042927616</td><td style="text-align:left">可以使用brk(2)扩展程序堆的地址。</td></tr><tr><td style="text-align:center">48</td><td style="text-align:left">arg_start=548828688219</td><td style="text-align:left">放置程序命令行参数（argv）的地址。</td></tr><tr><td style="text-align:center">49</td><td style="text-align:left">arg_end  =548828688223</td><td style="text-align:left">-</td></tr><tr><td style="text-align:center">50</td><td style="text-align:left">env_start=548828688223</td><td style="text-align:left">放置程序环境变量的地址。</td></tr><tr><td style="text-align:center">51</td><td style="text-align:left">env_end  =548828688363</td><td style="text-align:left">-</td></tr><tr><td style="text-align:center">52</td><td style="text-align:left">exit_code=0</td><td style="text-align:left">线程的退出状态采用waitpid(2)报告的形式。</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Linux系统上的/proc目录是一种文件系统，即proc文件系统。与其它常见的文件系统不同的是，/proc是一种伪文件系统（也即虚拟文件系统），存储的是当前内核运行状态的一系列特殊文件，用户可以通过这些文件查看有关系统硬件及当前正在运行进程的信息，甚至可以通过更改其中某些文件来改变内核的运行状态。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;所有说明均可通过&lt;code&gt;man proc&lt;/code&gt;获取&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="文件系统" scheme="http://winddoing.github.io/categories/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"/>
    
      <category term="proc" scheme="http://winddoing.github.io/categories/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/proc/"/>
    
    
      <category term="进程" scheme="http://winddoing.github.io/tags/%E8%BF%9B%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>回顾2018的点滴</title>
    <link href="http://winddoing.github.io/post/22139.html"/>
    <id>http://winddoing.github.io/post/22139.html</id>
    <published>2019-01-08T15:31:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/2019/01/2018_lijiang.png" alt="2018-lijiang"></p><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/2019/01/2018_lijiang.png&quot; alt=&quot;2018-lijiang&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://winddoing.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="随笔" scheme="http://winddoing.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu查询相关库的情况</title>
    <link href="http://winddoing.github.io/post/31784.html"/>
    <id>http://winddoing.github.io/post/31784.html</id>
    <published>2019-01-02T07:39:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>查询一个库的<code>位置</code></p><a id="more"></a><blockquote><p><strong>环境</strong>: Ubuntu 18.04.1 LTS</p><ul><li>测试库名: libmpfr</li></ul></blockquote><h2 id="库的相关描述"><a href="#库的相关描述" class="headerlink" title="库的相关描述"></a>库的相关描述</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$dpkg -l &quot;*库信息*&quot;</span><br></pre></td></tr></table></figure><p>示例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$dpkg -l &quot;*libmpfr*&quot;</span><br><span class="line">Desired=Unknown/Install/Remove/Purge/Hold</span><br><span class="line">| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend</span><br><span class="line">|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)</span><br><span class="line">||/ Name                                     Version                   Architecture              Description</span><br><span class="line">+++-========================================-=========================-=========================-======================================================================================</span><br><span class="line">ii  libmpfr6:amd64                           4.0.1-1                   amd64                     multiple precision floating-point computation</span><br></pre></td></tr></table></figure></p><h2 id="库的位置"><a href="#库的位置" class="headerlink" title="库的位置"></a>库的位置</h2><p>查询<code>libmpfr</code>的路径</p><h3 id="直接查找"><a href="#直接查找" class="headerlink" title="直接查找"></a>直接查找</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ldconfig -p | grep &quot;库信息&quot;</span><br></pre></td></tr></table></figure><p>示例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ldconfig -p | grep &quot;libmpfr&quot;</span><br><span class="line">libmpfr.so.6 (libc6,x86-64) =&gt; /usr/lib/x86_64-linux-gnu/libmpfr.so.6</span><br></pre></td></tr></table></figure></p><h3 id="间接查找"><a href="#间接查找" class="headerlink" title="间接查找"></a>间接查找</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -L &quot;库名称&quot;</span><br></pre></td></tr></table></figure><p>示例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$dpkg -L &quot;libmpfr6:amd64&quot;</span><br><span class="line">/.</span><br><span class="line">/usr</span><br><span class="line">/usr/lib</span><br><span class="line">/usr/lib/x86_64-linux-gnu</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libmpfr.so.6.0.1</span><br><span class="line">/usr/share</span><br><span class="line">/usr/share/doc</span><br><span class="line">/usr/share/doc/libmpfr6</span><br><span class="line">/usr/share/doc/libmpfr6/AUTHORS</span><br><span class="line">/usr/share/doc/libmpfr6/BUGS</span><br><span class="line">/usr/share/doc/libmpfr6/NEWS.gz</span><br><span class="line">/usr/share/doc/libmpfr6/README</span><br><span class="line">/usr/share/doc/libmpfr6/TODO.gz</span><br><span class="line">/usr/share/doc/libmpfr6/changelog.Debian.gz</span><br><span class="line">/usr/share/doc/libmpfr6/copyright</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libmpfr.so.6</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;查询一个库的&lt;code&gt;位置&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="工具" scheme="http://winddoing.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="库" scheme="http://winddoing.github.io/tags/%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>linux下shell基础--软连接处理</title>
    <link href="http://winddoing.github.io/post/55887.html"/>
    <id>http://winddoing.github.io/post/55887.html</id>
    <published>2018-12-21T09:14:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>软连接的截取和定位</p><p>场景: 当前所执行的脚本是连接,获取其实际的路径(位置)</p><a id="more"></a><h2 id="判断软连接"><a href="#判断软连接" class="headerlink" title="判断软连接"></a>判断软连接</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">if [ -h "a.sh" ]; then</span><br><span class="line">    echo "It's a soft connection"</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><blockquote><p><code>-h</code>: 软连接</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">PRG=$0</span><br><span class="line">ls=`ls -ld "$PRG"`                       </span><br><span class="line">link=`expr "$ls" : '.*-&gt; \(.*\)$'`       </span><br><span class="line"></span><br><span class="line">echo "Current script PRG: $PRG"</span><br><span class="line">echo "Soft connection path link: $link"</span><br><span class="line"></span><br><span class="line">echo "Get the current path: `dirname "$PRG"`"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断软连接是否在当前目录下</span></span><br><span class="line">if expr "$link" : '/.*' &gt; /dev/null; then        </span><br><span class="line">    PRG="$link"                                  </span><br><span class="line">else                                             </span><br><span class="line">    PRG="`dirname "$PRG"`/$link"                 </span><br><span class="line">fi                                               </span><br><span class="line"></span><br><span class="line">echo "Soft connection path link: $link"</span><br><span class="line">echo "Actual script path PRG: $PRG"</span><br></pre></td></tr></table></figure><p>测试环境: 保存脚本到xx.sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$mkdir -p aa/bb/cc</span><br><span class="line">$mv xx.sh aa/bb/cc</span><br><span class="line">$ln -s aa/bb/cc/xx.sh xx.sh</span><br><span class="line">$ls -ld xx.sh</span><br><span class="line">lrwxrwxrwx 1 xxx xxx 14 12月 21 16:57 xx.sh -&gt; aa/bb/cc/xx.sh</span><br><span class="line">$./xx.sh</span><br></pre></td></tr></table></figure><p>执行脚本:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$./xx.sh</span><br><span class="line">Current script PRG: ./xx.sh</span><br><span class="line">Soft connection path link: aa/bb/cc/xx.sh</span><br><span class="line">Get the current path: .</span><br><span class="line">Soft connection path link: aa/bb/cc/xx.sh</span><br><span class="line">Actual script path PRG: ./aa/bb/cc/xx.sh</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;软连接的截取和定位&lt;/p&gt;
&lt;p&gt;场景: 当前所执行的脚本是连接,获取其实际的路径(位置)&lt;/p&gt;
    
    </summary>
    
      <category term="shell" scheme="http://winddoing.github.io/categories/shell/"/>
    
    
      <category term="Shell" scheme="http://winddoing.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>进程状态-Z:僵尸进程产生的原因</title>
    <link href="http://winddoing.github.io/post/5718.html"/>
    <id>http://winddoing.github.io/post/5718.html</id>
    <published>2018-12-20T09:36:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p><code>Z (zombie)</code>:僵死状态是一个比较特殊的状态。进程在退出的过程中，处于<code>TASK_DEAD</code>状态。</p><blockquote><p>在这个退出过程中，进程占有的所有资源将被回收，除了task_struct结构（以及少数资源）以外。于是进程就只剩下task_struct这么个空壳，故称为僵尸。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ps</span></span><br><span class="line">  PID USER       VSZ STAT COMMAND</span><br><span class="line">    1 root      3100 S    init</span><br><span class="line">    2 root         0 SW   [kthreadd]</span><br><span class="line">    3 root         0 SW   [ksoftirqd/0]</span><br><span class="line">    4 root         0 SW   [kworker/0:0]</span><br><span class="line">    5 root         0 SW&lt;  [kworker/0:0H]</span><br><span class="line">    6 root         0 SW   [kworker/u8:0]</span><br><span class="line">    ...</span><br><span class="line">    1380 root      0 Z    [view]     #僵尸进程</span><br><span class="line">    ...</span><br><span class="line">    1392 root   3104 S    -/bin/sh</span><br><span class="line">    1404 root      0 SW&lt;  [kworker/2:1H]</span><br><span class="line">    1429 root      0 SW&lt;  [kworker/0:1H]</span><br><span class="line">    1444 root      0 SW&lt;  [kworker/1:1H]</span><br></pre></td></tr></table></figure><ul><li>僵尸进程产生的原因???</li><li>如何确定根本原因???</li><li>如何避免???</li></ul><a id="more"></a><h2 id="僵尸进程产生的原因"><a href="#僵尸进程产生的原因" class="headerlink" title="僵尸进程产生的原因"></a>僵尸进程产生的原因</h2><blockquote><p><strong>僵尸进程</strong>: 是当子进程比父进程先结束，而父进程又没有回收子进程，释放子进程占用的资源，此时子进程将成为一个僵尸进程。如果父进程先退出 ，子进程被init接管，子进程退出后init会回收其占用的相关资源</p></blockquote><p>原因:</p><ol><li>子进程被直接杀死</li><li>子进程无法正常关闭</li></ol><p>场景:主进程创建的线程在进行数据搬运时,搬运数据的大小超过了放置数据buffer的大小,导致部分数据被污染,最终导致子线程在运行过程中出现段错误,将其直接杀死,没有等到父进程回收,而产生了僵尸进程.</p><h2 id="调试-amp-amp-Debug"><a href="#调试-amp-amp-Debug" class="headerlink" title="调试&amp;&amp;Debug"></a>调试&amp;&amp;Debug</h2><ul><li>查找子进程被杀死的原因,如,段错误可以重新定义段错误信号的处理打印部分信息.</li><li>排查显示fork和隐式fork,对子进程的操作.</li><li>子进程退出信号<code>signal(SIGCHLD,sig_child)</code>的自定义处理</li></ul><h2 id="设计时的预防"><a href="#设计时的预防" class="headerlink" title="设计时的预防"></a>设计时的预防</h2><ul><li><p>父进程通过wait和waitpid等函数等待子进程结束，这会导致父进程挂起。</p><ul><li>执行wait（）或waitpid（）系统调用，则子进程在终止后会立即把它在进程表中的数据返回给父进程，此时系统会立即删除该进入点。在这种情形下就不会产生defunct进程。</li></ul></li><li><p>如果父进程很忙，那么可以用signal函数为SIGCHLD安装handler。在子进程结束后，父进程会收到该信号，可以在handler中调用wait回收。</p></li><li><p>如果父进程不关心子进程什么时候结束，那么可以用signal（SIGCLD, SIG_IGN）或signal（SIGCHLD, SIG_IGN）通知内核，自己对子进程的结束不感兴趣，那么子进程结束后，内核会回收，并不再给父进程发送信号</p></li><li><p>fork两次，父进程fork一个子进程，然后继续工作，子进程fork一个孙进程后退出，那么孙进程被init接管，孙进程结束后，init会回收。不过子进程的回收还要自己做</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;Z (zombie)&lt;/code&gt;:僵死状态是一个比较特殊的状态。进程在退出的过程中，处于&lt;code&gt;TASK_DEAD&lt;/code&gt;状态。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在这个退出过程中，进程占有的所有资源将被回收，除了task_struct结构（以及少数资源）以外。于是进程就只剩下task_struct这么个空壳，故称为僵尸。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;bash&quot;&gt; ps&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  PID USER       VSZ STAT COMMAND&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    1 root      3100 S    init&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    2 root         0 SW   [kthreadd]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    3 root         0 SW   [ksoftirqd/0]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    4 root         0 SW   [kworker/0:0]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    5 root         0 SW&amp;lt;  [kworker/0:0H]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    6 root         0 SW   [kworker/u8:0]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    1380 root      0 Z    [view]     #僵尸进程&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    1392 root   3104 S    -/bin/sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    1404 root      0 SW&amp;lt;  [kworker/2:1H]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    1429 root      0 SW&amp;lt;  [kworker/0:1H]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    1444 root      0 SW&amp;lt;  [kworker/1:1H]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;僵尸进程产生的原因???&lt;/li&gt;
&lt;li&gt;如何确定根本原因???&lt;/li&gt;
&lt;li&gt;如何避免???&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="进程" scheme="http://winddoing.github.io/categories/%E8%BF%9B%E7%A8%8B/"/>
    
      <category term="进程状态" scheme="http://winddoing.github.io/categories/%E8%BF%9B%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81/"/>
    
    
      <category term="进程" scheme="http://winddoing.github.io/tags/%E8%BF%9B%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>ARM处理器寄存器和汇编指令</title>
    <link href="http://winddoing.github.io/post/25025.html"/>
    <id>http://winddoing.github.io/post/25025.html</id>
    <published>2018-12-18T01:40:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>ARM体系结构支持<code>7种</code>处理器模式，分别是：<code>用户</code>、<code>FIQ</code>、<code>IRQ</code>、<code>管理</code>、<code>中止（abort）</code>、<code>未定义</code>和<code>系统</code>模式。除了用户模式外，其余都称之为特权模式。除了用户和系统模式外，其余都称之为异常模式</p><a id="more"></a><h2 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h2><p>ARM的寄存器分为两类, <code>普通寄存器</code>和<code>状态寄存器</code></p><p>普通寄存器总共16个，分别为R0-R15；状态寄存器共2个，分别为<code>CPSR</code>和<code>SPSR</code></p><table><thead><tr><th style="text-align:center">寄存器(Reg)</th><th style="text-align:center">寄存器(APCS)</th><th style="text-align:left">作用域</th><th style="text-align:left">含义</th></tr></thead><tbody><tr><td style="text-align:center">R0</td><td style="text-align:center">a1</td><td style="text-align:left">所有7种模式</td><td style="text-align:left">工作寄存器</td></tr><tr><td style="text-align:center">R1</td><td style="text-align:center">a2</td><td style="text-align:left">所有7种模式</td><td style="text-align:left">..</td></tr><tr><td style="text-align:center">R2</td><td style="text-align:center">a3</td><td style="text-align:left">所有7种模式</td><td style="text-align:left">..</td></tr><tr><td style="text-align:center">R3</td><td style="text-align:center">a4</td><td style="text-align:left">所有7种模式</td><td style="text-align:left">..</td></tr><tr><td style="text-align:center">R4</td><td style="text-align:center">v1</td><td style="text-align:left">所有7种模式</td><td style="text-align:left">必须保护</td></tr><tr><td style="text-align:center">R5</td><td style="text-align:center">v2</td><td style="text-align:left">所有7种模式</td><td style="text-align:left">..</td></tr><tr><td style="text-align:center">R6</td><td style="text-align:center">v3</td><td style="text-align:left">所有7种模式</td><td style="text-align:left">..</td></tr><tr><td style="text-align:center">R7</td><td style="text-align:center">v4</td><td style="text-align:left">所有7种模式</td><td style="text-align:left">..</td></tr><tr><td style="text-align:center">R8</td><td style="text-align:center">v5</td><td style="text-align:left">除FIQ模式</td><td style="text-align:left">..</td></tr><tr><td style="text-align:center">R9</td><td style="text-align:center">v6</td><td style="text-align:left">除FIQ模式</td><td style="text-align:left">..</td></tr><tr><td style="text-align:center">R10</td><td style="text-align:center">sl</td><td style="text-align:left">除FIQ模式</td><td style="text-align:left">栈限制</td></tr><tr><td style="text-align:center">R11</td><td style="text-align:center">fp</td><td style="text-align:left">除FIQ模式</td><td style="text-align:left">帧指针</td></tr><tr><td style="text-align:center">R12</td><td style="text-align:center">ip</td><td style="text-align:left">除FIQ模式</td><td style="text-align:left">内部过程调用寄存器</td></tr><tr><td style="text-align:center">R13</td><td style="text-align:center">sp</td><td style="text-align:left">用户和系统模式</td><td style="text-align:left">栈指针</td></tr><tr><td style="text-align:center">R14</td><td style="text-align:center">lr</td><td style="text-align:left">用户和系统模式</td><td style="text-align:left">连接寄存器</td></tr><tr><td style="text-align:center">R15</td><td style="text-align:center">pc</td><td style="text-align:left">所有7种模式</td><td style="text-align:left">程序计数器</td></tr><tr><td style="text-align:center">CPSR</td><td style="text-align:center">-</td><td style="text-align:left">-</td><td style="text-align:left"></td></tr><tr><td style="text-align:center">SPSR</td><td style="text-align:center">-</td><td style="text-align:left">除用户和系统模式</td><td style="text-align:left">-</td></tr></tbody></table><ul><li><code>R13(sp)</code>: 每一种异常模式都有其自己独立的r13，它通常指向异常模式所专用的堆栈，也就是说五种异常模式、非异常模式（用户模式和系统模式），都有各自独立的堆栈，用不同的堆栈指针来索引。这样当ARM进入异常模式的时候，程序就可以把一般通用寄存器压入堆栈，返回时再出栈，保证了各种模式下程序的状态的完整性。</li><li><code>R14(lr)</code>: 每种模式下r14都有自身版组，它有两个特殊功能。<ul><li>保存子程序返回地址。使用BL或BLX时，跳转指令自动把返回地址放入r14中；子程序通过把r14复制到PC来实现返回，通常用下列指令之一：</li><li>当异常发生时，异常模式的r14用来保存异常返回地址，将r14如栈可以处理嵌套中断。</li></ul></li></ul><h3 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h3><p>ARM处理器中通常将寄存器R13作为堆栈指针（SP）。ARM处理器针对不同的模式，共有<strong>6个堆栈指针SP</strong>, 其中用户模式和系统模式共用一个SP，每种异常模式都有各自专用的R13寄存器（SP）。它们通常指向各模式所对应的专用堆栈，也就是ARM处理器允许用户程序有六个不同的堆栈空间。这些堆栈指针分别为R13、R13_svc、R13_abt、R13_und、R13_irq、R13_fiq.</p><p><img src="/images/2018/12/arm_asm_reg_sp.png" alt="arm_asm_reg_sp"></p><h2 id="汇编指令"><a href="#汇编指令" class="headerlink" title="汇编指令"></a>汇编指令</h2><h3 id="存储器访问指令"><a href="#存储器访问指令" class="headerlink" title="存储器访问指令"></a>存储器访问指令</h3><p>ARM 处理是加载/存储体系结构的典型的RISC处理器，对存储器的访问只能使用<code>加载</code>和<code>存储</code>指令实现。ARM 的加载/存储指令是可以实现字、半字、无符/有符字节操作；批量加载/存储指令可实现一条指令加载/存储多个寄存器的内容，大大提高效率；SWP指令是一条寄存器和存储器内容交换的指令，可用于信号量操作等。</p><h4 id="LDR和STR"><a href="#LDR和STR" class="headerlink" title="LDR和STR"></a>LDR和STR</h4><p>加载/存储字和无符号字节指令。使用单一数据传送指令(STR 和LDR)来装载和存储单一字节或字的数据从/到内存。</p><ul><li><code>LDR</code> 指令用于从内存中读取数据放入寄存器中；</li><li><code>STR</code> 指令用于将寄存器中的数据保存到内存。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LDR&#123;cond&#125;&#123;T&#125; Rd,&lt;地址&gt;    ;加载指定地址上的数据(字)，放入Rd中</span><br><span class="line">STR&#123;cond&#125;&#123;T&#125; Rd,&lt;地址&gt;    ;存储数据(字)到指定地址的存储单元，要存储的数据在Rd中</span><br><span class="line">LDR&#123;cond&#125;B&#123;T&#125; Rd,&lt;地址&gt;   ;加载字节数据，放入Rd中，即Rd最低字节有效，高24位清零</span><br><span class="line">STR&#123;cond&#125;B&#123;T&#125; Rd,&lt;地址&gt;   ;存储字节数据，要存储的数据在Rd，最低字节有效</span><br></pre></td></tr></table></figure><blockquote><p>其中，T 为可选后缀，若指令有T，那么即使处理器是在特权模式下，存储系统也将访问看成是处理器是在用户模式下。T在用户模式下无效，不能与前索引偏移一起使用T</p></blockquote><ul><li><p>立即数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LDR R1,[R0,#0x12]   ;将R0+0x12 地址处的数据读出，保存到R1中(R0 的值不变)</span><br><span class="line">LDR R1,[R0,#-0x12]  ;将R0-0x12 地址处的数据读出，保存到R1中(R0 的值不变)</span><br><span class="line">LDR R1,[R0]         ;将R0 地址处的数据读出，保存到R1 中(零偏移)</span><br></pre></td></tr></table></figure></li><li><p>寄存器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LDR R1,[R0,R2]      ;将R0+R2 地址的数据计读出，保存到R1中(R0 的值不变)</span><br><span class="line">LDR R1,[R0,-R2]     ;将R0-R2 地址处的数据计读出，保存到R1中(R0 的值不变)</span><br></pre></td></tr></table></figure></li><li><p>寄存器及移位常数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LDR R1,[R0,R2,LSL #2]   ;将R0+R2*4地址处的数据读出，保存到R1中（R0，R2的值不变）</span><br><span class="line">LDR R1,[R0,-R2,LSL #2]  ;将R0-R2*4地址处的数据计读出，保存到R1中(R0，R2的值不变)</span><br></pre></td></tr></table></figure></li></ul><h3 id="数据处理指令"><a href="#数据处理指令" class="headerlink" title="数据处理指令"></a>数据处理指令</h3><h3 id="跳转指令"><a href="#跳转指令" class="headerlink" title="跳转指令"></a>跳转指令</h3><h3 id="状态寄存器指令"><a href="#状态寄存器指令" class="headerlink" title="状态寄存器指令"></a>状态寄存器指令</h3><h3 id="ARM协处理器指令"><a href="#ARM协处理器指令" class="headerlink" title="ARM协处理器指令"></a>ARM协处理器指令</h3><h2 id="示例分析"><a href="#示例分析" class="headerlink" title="示例分析"></a>示例分析</h2><h3 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b, c;</span><br><span class="line"></span><br><span class="line">    b = <span class="number">3</span>;</span><br><span class="line">    c = a + b;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Hello c=%d!\n"</span>, c);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabihf-gcc hello.c -o hello --save-temp</span><br></pre></td></tr></table></figure></p><h3 id="汇编代码"><a href="#汇编代码" class="headerlink" title="汇编代码"></a>汇编代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">.arch armv7-a</span><br><span class="line">.eabi_attribute 28, 1</span><br><span class="line">.eabi_attribute 20, 1</span><br><span class="line">.eabi_attribute 21, 1</span><br><span class="line">.eabi_attribute 23, 3</span><br><span class="line">.eabi_attribute 24, 1</span><br><span class="line">.eabi_attribute 25, 1</span><br><span class="line">.eabi_attribute 26, 2</span><br><span class="line">.eabi_attribute 30, 6</span><br><span class="line">.eabi_attribute 34, 1</span><br><span class="line">.eabi_attribute 18, 4</span><br><span class="line">.file&quot;hello.c&quot;</span><br><span class="line">.text</span><br><span class="line">.section.rodata</span><br><span class="line">.align2</span><br><span class="line">.LC0:</span><br><span class="line">.ascii&quot;Hello c=%d!\012\000&quot;</span><br><span class="line">.text</span><br><span class="line">.align1</span><br><span class="line">.globalmain</span><br><span class="line">.syntax unified</span><br><span class="line">.thumb</span><br><span class="line">.thumb_func</span><br><span class="line">.fpu vfpv3-d16</span><br><span class="line">.typemain, %function</span><br><span class="line">main:</span><br><span class="line">@ args = 0, pretend = 0, frame = 24</span><br><span class="line">@ frame_needed = 1, uses_anonymous_args = 0</span><br><span class="line">push&#123;r7, lr&#125;</span><br><span class="line">subsp, sp, #24</span><br><span class="line">addr7, sp, #0</span><br><span class="line">strr0, [r7, #4]</span><br><span class="line">strr1, [r7]</span><br><span class="line">movsr3, #1</span><br><span class="line">strr3, [r7, #20]</span><br><span class="line">movsr3, #3</span><br><span class="line">strr3, [r7, #16]</span><br><span class="line">ldrr2, [r7, #20]</span><br><span class="line">ldrr3, [r7, #16]</span><br><span class="line">addr3, r3, r2</span><br><span class="line">strr3, [r7, #12]</span><br><span class="line">ldrr1, [r7, #12]</span><br><span class="line">movwr0, #:lower16:.LC0</span><br><span class="line">movtr0, #:upper16:.LC0</span><br><span class="line">blprintf</span><br><span class="line">movsr3, #0</span><br><span class="line">movr0, r3</span><br><span class="line">addsr7, r7, #24</span><br><span class="line">movsp, r7</span><br><span class="line">@ sp needed</span><br><span class="line">pop&#123;r7, pc&#125;</span><br><span class="line">.sizemain, .-main</span><br><span class="line">.ident&quot;GCC: (Linaro GCC 7.3-2018.05) 7.3.1 20180425 [linaro-7.3-2018.05 revision d29120a424ecfbc167ef90065c0eeb7f91977701]&quot;</span><br><span class="line">.section.note.GNU-stack,&quot;&quot;,%progbits</span><br></pre></td></tr></table></figure><blockquote><p><code>@</code>: 单行注释</p></blockquote><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://www.cnblogs.com/uestcbutcher/p/7244799.html" target="_blank" rel="noopener">ARM指令集详解</a></li><li><a href="https://blog.csdn.net/u013736724/article/details/53200539" target="_blank" rel="noopener">ARM汇编语言学习笔记（一）—ARM汇编的程序结构</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ARM体系结构支持&lt;code&gt;7种&lt;/code&gt;处理器模式，分别是：&lt;code&gt;用户&lt;/code&gt;、&lt;code&gt;FIQ&lt;/code&gt;、&lt;code&gt;IRQ&lt;/code&gt;、&lt;code&gt;管理&lt;/code&gt;、&lt;code&gt;中止（abort）&lt;/code&gt;、&lt;code&gt;未定义&lt;/code&gt;和&lt;code&gt;系统&lt;/code&gt;模式。除了用户模式外，其余都称之为特权模式。除了用户和系统模式外，其余都称之为异常模式&lt;/p&gt;
    
    </summary>
    
      <category term="ARM" scheme="http://winddoing.github.io/categories/ARM/"/>
    
      <category term="汇编" scheme="http://winddoing.github.io/categories/ARM/%E6%B1%87%E7%BC%96/"/>
    
    
      <category term="ARM" scheme="http://winddoing.github.io/tags/ARM/"/>
    
      <category term="寄存器" scheme="http://winddoing.github.io/tags/%E5%AF%84%E5%AD%98%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>ARM--GCC内嵌汇编</title>
    <link href="http://winddoing.github.io/post/4526.html"/>
    <id>http://winddoing.github.io/post/4526.html</id>
    <published>2018-12-14T02:02:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>记录ARM平台中相关的汇编操作和总结</p><a id="more"></a><h2 id="空指令–nop"><a href="#空指令–nop" class="headerlink" title="空指令–nop"></a>空指令–nop</h2><p>NOP指令<code>不产生任何意义的操作</code>,只占用一个机器周期,可以用于简单的延时操作</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">asm</span>(<span class="string">"nop"</span>);</span><br></pre></td></tr></table></figure><blockquote><p>在C代码中可以通过前后使用<code>nop</code>定位反汇编后代码所在的位置.</p></blockquote><p>实际编程的用途:</p><ol><li>需要短暂延时</li><li>需要精确控制延时,如控制驱动器步进电机的延时</li><li>通过在写NOP指令处填写相应代码实现分支跳转或分支调用???</li><li>解密时用???</li><li>在控制系统中插入NOP指令防止系统飞程???</li></ol><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://blog.csdn.net/erazy0/article/details/6071281" target="_blank" rel="noopener">NOP 指令作用</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录ARM平台中相关的汇编操作和总结&lt;/p&gt;
    
    </summary>
    
      <category term="ARM" scheme="http://winddoing.github.io/categories/ARM/"/>
    
      <category term="汇编" scheme="http://winddoing.github.io/categories/ARM/%E6%B1%87%E7%BC%96/"/>
    
    
      <category term="ARM" scheme="http://winddoing.github.io/tags/ARM/"/>
    
      <category term="汇编" scheme="http://winddoing.github.io/tags/%E6%B1%87%E7%BC%96/"/>
    
  </entry>
  
  <entry>
    <title>Linux内核工具--Sparse</title>
    <link href="http://winddoing.github.io/post/22743.html"/>
    <id>http://winddoing.github.io/post/22743.html</id>
    <published>2018-12-05T08:22:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>Sparse诞生于2004年，是由Linux之父开发的，目的就是提供一个静态检查代码的工具，从而减少Linux内核的隐患。起始，在Sparse之前已经有了一个不错的代码静态检查工具（SWAT），只不过这个工具不是免费软件，使用上有一些限制。所以Linus自己开发了一个静态检查工具。</p><blockquote><p>版本: linux4.4.166</p><p>参考文档:<a href="https://elixir.bootlin.com/linux/v4.4.166/source/Documentation/sparse.txt" target="_blank" rel="noopener">Documentation/sparse.txt</a></p></blockquote><a id="more"></a><p>Sparse通过gcc的扩展属性<code>__attribute__</code>以及自己定义的<code>__context__</code>来对代码进行静态检查。</p><blockquote><p><code>__xxx</code>双下划线开头的宏,表示编译器相关的一些属性设置</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __CHECKER__</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __user     __attribute__((noderef, address_space(1)))</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __kernel   __attribute__((address_space(0)))</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __safe     __attribute__((safe))</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __force    __attribute__((force))</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __nocast   __attribute__((nocast))</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __iomem    __attribute__((noderef, address_space(2)))</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __must_hold(x) __attribute__((context(x,1,1)))</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __acquires(x)  __attribute__((context(x,0,1)))</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __releases(x)  __attribute__((context(x,1,0)))</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __acquire(x)   __context__(x,1)</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __release(x)   __context__(x,-1)</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __cond_lock(x,c)   ((c) ? (&#123; __acquire(x); 1; &#125;) : 0)</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __percpu   __attribute__((noderef, address_space(3)))</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __pmem     __attribute__((noderef, address_space(5)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SPARSE_RCU_POINTER</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __rcu      __attribute__((noderef, address_space(4)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __rcu</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">void</span> __chk_user_ptr(<span class="keyword">const</span> <span class="keyword">volatile</span> <span class="keyword">void</span> __user *);</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">void</span> __chk_io_ptr(<span class="keyword">const</span> <span class="keyword">volatile</span> <span class="keyword">void</span> __iomem *);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br></pre></td></tr></table></figure><blockquote><p>file: include/linux/compiler.h</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __CHECKER__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __bitwise__ __attribute__((bitwise))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __bitwise__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __CHECK_ENDIAN__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __bitwise __bitwise__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __bitwise</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><blockquote><p>file: tools/include/linux/types.h</p></blockquote><table><thead><tr><th style="text-align:center">宏名称</th><th style="text-align:center">定义</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">__bitwise</td><td style="text-align:center"><code>__attribute__((bitwise))</code></td><td style="text-align:center">确保变量是相同的位方式(比如 bit-endian, little-endiandeng)</td></tr><tr><td style="text-align:center">__user</td><td style="text-align:center"><code>__attribute__((noderef, address_space(1)))</code></td><td style="text-align:center">指针地址必须在用户地址空间</td></tr><tr><td style="text-align:center">__kernel</td><td style="text-align:center"><code>__attribute__((noderef, address_space(0)))</code></td><td style="text-align:center">指针地址必须在内核地址空间</td></tr><tr><td style="text-align:center">__iomem</td><td style="text-align:center"><code>__attribute__((noderef, address_space(2)))</code></td><td style="text-align:center">指针地址必须在设备地址空间</td></tr><tr><td style="text-align:center">__safe</td><td style="text-align:center"><code>__attribute__((safe))</code></td><td style="text-align:center">变量可以为空</td></tr><tr><td style="text-align:center">__force</td><td style="text-align:center"><code>__attribute__((force))</code></td><td style="text-align:center">变量可以进行强制转换</td></tr><tr><td style="text-align:center">__nocast</td><td style="text-align:center"><code>__attribute__((nocast))</code></td><td style="text-align:center">参数类型与实际参数类型必须一致</td></tr><tr><td style="text-align:center">__acquires(x)</td><td style="text-align:center"><code>__attribute__((context(x, 0, 1)))</code></td><td style="text-align:center">参数x 在执行前引用计数必须是0,执行后,引用计数必须为1</td></tr><tr><td style="text-align:center">__releases(x)</td><td style="text-align:center"><code>__attribute__((context(x, 1, 0)))</code></td><td style="text-align:center">与__acquires(x)相反</td></tr><tr><td style="text-align:center">__acquire(x)</td><td style="text-align:center"><code>__context__(x, 1)</code></td><td style="text-align:center">参数x的引用计数+1</td></tr><tr><td style="text-align:center">__release(x)</td><td style="text-align:center"><code>__context__(x, 1)</code></td><td style="text-align:center">与__acquire(x)相反</td></tr><tr><td style="text-align:center">__cond_lock(x,c)</td><td style="text-align:center"><code>((c) ? ({ __acquire(x); 1; }) : 0)</code></td><td style="text-align:center">参数c 不为0时,引用计数 + 1, 并返回1</td></tr></tbody></table><blockquote><p>其中<code>__acquires(x)</code>和<code>__releases(x)</code>，<code>__acquire(x)</code>和<code>__release(x)</code>必须配对使用,都和<code>锁</code>有关，否则Sparse会发出警告</p></blockquote><h2 id="Sparse-在编译内核中的使用"><a href="#Sparse-在编译内核中的使用" class="headerlink" title="Sparse 在编译内核中的使用"></a>Sparse 在编译内核中的使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make C=1 检查所有重新编译的代码</span><br><span class="line">make C=2 检查所有代码, 不管是不是被重新编译</span><br></pre></td></tr></table></figure><blockquote><p>如果进行<code>-Wbitwise</code>的检查,需要定义<code>#define __CHECK_ENDIAN__</code>,可以通过<code>CF</code>进行传参<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;  make C=2 CF=&quot;-D__CHECK_ENDIAN__&quot;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">fb_open(struct inode *inode, struct file *file)</span><br><span class="line">__acquires(&amp;info-&gt;lock)</span><br><span class="line">__releases(&amp;info-&gt;lock)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在编译阶段检查锁,防止死锁.</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://www.cnblogs.com/wang_yb/p/3575039.html" target="_blank" rel="noopener">内核工具 – Sparse 简介</a></li><li><a href="https://stackoverflow.com/questions/21018778/what-does-static-int-function-acquires-releases-mean" target="_blank" rel="noopener">what-does-static-int-function-acquires-releases-mean</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Sparse诞生于2004年，是由Linux之父开发的，目的就是提供一个静态检查代码的工具，从而减少Linux内核的隐患。起始，在Sparse之前已经有了一个不错的代码静态检查工具（SWAT），只不过这个工具不是免费软件，使用上有一些限制。所以Linus自己开发了一个静态检查工具。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;版本: linux4.4.166&lt;/p&gt;
&lt;p&gt;参考文档:&lt;a href=&quot;https://elixir.bootlin.com/linux/v4.4.166/source/Documentation/sparse.txt&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Documentation/sparse.txt&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux内核" scheme="http://winddoing.github.io/categories/Linux%E5%86%85%E6%A0%B8/"/>
    
      <category term="工具" scheme="http://winddoing.github.io/categories/Linux%E5%86%85%E6%A0%B8/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="Linux" scheme="http://winddoing.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>RTCP协议</title>
    <link href="http://winddoing.github.io/post/32277.html"/>
    <id>http://winddoing.github.io/post/32277.html</id>
    <published>2018-11-29T01:28:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Real-time Transport Control Protocol或RTP Control Protocol或简写RTCP）是实时传输协议（RTP）的一个姐妹协议。RTCP由<a href="https://tools.ietf.org/html/rfc3550" target="_blank" rel="noopener">RFC 3550</a>定义（取代作废的RFC 1889）。RTP 使用一个 偶数 UDP port ；而RTCP 则使用 RTP 的下一个 port，也就是一个奇数 port。RTCP与RTP联合工作，RTP实施实际数据的传输，RTCP则负责将控制包送至电话中的每个人。其主要功能是就RTP正在提供的服务质量(Quality of Service)做出反馈。</p></blockquote><p>RTCP协议将控制包周期发送给所有连接者，应用与数据包相同的分布机制。低层协议提供数据与控制包的复用，如使用单独的UDP端口号。</p><p>作用:</p><ul><li>主要是提供数据发布的质量反馈</li><li>RTCP带有称作规范名字（CNAME）的RTP源持久传输层标识</li><li>传送最小连接控制信息，如参加者辨识</li></ul><a id="more"></a><h2 id="RTCP分类"><a href="#RTCP分类" class="headerlink" title="RTCP分类"></a>RTCP分类</h2><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">缩写</th><th style="text-align:center">用途</th></tr></thead><tbody><tr><td style="text-align:center">200</td><td style="text-align:center">SR（Sender Report）</td><td style="text-align:center">发送端报告</td></tr><tr><td style="text-align:center">201</td><td style="text-align:center">RR（Receiver Report）</td><td style="text-align:center">接收端报告</td></tr><tr><td style="text-align:center">202</td><td style="text-align:center">SDES（Source Description Items）</td><td style="text-align:center">源点描述</td></tr><tr><td style="text-align:center">203</td><td style="text-align:center">BYE</td><td style="text-align:center">结束传输</td></tr><tr><td style="text-align:center">204</td><td style="text-align:center">APP</td><td style="text-align:center">特定应用</td></tr></tbody></table><h3 id="RTCP的扩展"><a href="#RTCP的扩展" class="headerlink" title="RTCP的扩展"></a>RTCP的扩展</h3><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">缩写</th><th style="text-align:center">用途</th><th style="text-align:center">所在RFC</th></tr></thead><tbody><tr><td style="text-align:center">195</td><td style="text-align:center">1J(Extended Jitter Report)</td><td style="text-align:center">扩展Jitter报告</td><td style="text-align:center">RFC 5450</td></tr><tr><td style="text-align:center">205</td><td style="text-align:center">RTPFB(Transport FB)</td><td style="text-align:center">传输层反馈</td><td style="text-align:center"><a href="https://tools.ietf.org/html/rfc4585" target="_blank" rel="noopener">RFC 4585</a></td></tr><tr><td style="text-align:center">206</td><td style="text-align:center">PSFB(Payload-specific FB)</td><td style="text-align:center">负载相关反馈</td><td style="text-align:center">RFC 5104</td></tr><tr><td style="text-align:center">207</td><td style="text-align:center">XR(Exteneded Report)</td><td style="text-align:center">扩展报告</td><td style="text-align:center">RFC 3611</td></tr></tbody></table><blockquote><ul><li>FB: Feedback(反馈)</li></ul></blockquote><h2 id="反馈报文"><a href="#反馈报文" class="headerlink" title="反馈报文"></a>反馈报文</h2><p>类型:</p><ul><li>Transport layer FB messages</li><li>Payload-specific FB messages</li><li>Application layer FB messages</li></ul><h3 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0                   1                   2                   3</span><br><span class="line">  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line"> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line"> |V=2|P|   FMT   |       PT      |          length               |</span><br><span class="line"> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line"> |                  SSRC of packet sender                        |</span><br><span class="line"> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line"> |                  SSRC of media source                         |</span><br><span class="line"> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line"> :            Feedback Control Information (FCI)                 :</span><br><span class="line"> :                                                               :</span><br></pre></td></tr></table></figure><ul><li>version(V), 2bits : 标识当前RTP版本2</li><li>padding(P), 1bit : 填充位标识</li><li>Feedback message type(FMT), 5bits : 标识反馈消息的类型</li><li>Payload type (PT), 8 bits : rtcp包的类型</li><li>Length, 16 bits :</li></ul><h3 id="FMT报文子类型"><a href="#FMT报文子类型" class="headerlink" title="FMT报文子类型"></a>FMT报文子类型</h3><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">子类型</th><th style="text-align:center">缩写</th><th style="text-align:center">用途</th></tr></thead><tbody><tr><td style="text-align:center">205</td><td style="text-align:center">1</td><td style="text-align:center">Generic NACK</td><td style="text-align:center">RTP丢包重传</td></tr><tr><td style="text-align:center">-</td><td style="text-align:center">3</td><td style="text-align:center">TMMBR</td><td style="text-align:center">Temporary Maximum Media Stream Bitrate Request</td></tr><tr><td style="text-align:center">-</td><td style="text-align:center">4</td><td style="text-align:center">TMMBN</td><td style="text-align:center">Temporary Maximum Media Stream Bitrate Notification</td></tr><tr><td style="text-align:center">206</td><td style="text-align:center">1</td><td style="text-align:center">PLI</td><td style="text-align:center">Picture Loss Indication</td></tr></tbody></table><h3 id="Generic-NACK"><a href="#Generic-NACK" class="headerlink" title="Generic NACK"></a>Generic NACK</h3><blockquote><p>The Generic NACK message is identified by <code>PT=RTPFB</code> and <code>FMT=1</code>.</p></blockquote><p>消息语法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0                   1                   2                   3</span><br><span class="line">  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line"> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line"> |            PID                |             BLP               |</span><br><span class="line"> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure></p><ul><li>PID: Packet ID (PID): 16 bits<ul><li>丢失RTP包的ID</li></ul></li><li>BLP:  bitmask of following lost packets (BLP): 16 bits<ul><li>从PID开始接下来16个RTP数据包的丢失情况,一个NACK报文可以携带多个RTP序列号，NACK接收端对这些序列号逐个处理。</li></ul></li></ul><h2 id="丢包重传"><a href="#丢包重传" class="headerlink" title="丢包重传"></a>丢包重传</h2><p>如果在接收端检查到出现丢包现象,通过RTCP发送丢包ID接可以让丢包重传.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RequestLostPacket</span><span class="params">(<span class="keyword">rtp_t</span> *rtp, <span class="keyword">unsigned</span> <span class="keyword">int</span> rtpSsrc, <span class="keyword">int</span> seqNo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> FB_msg_packet[<span class="number">128</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> srcId = rtpSsrc;</span><br><span class="line">    <span class="keyword">int</span> blp = <span class="number">0</span>; <span class="comment">//表示一个只处理一个丢包</span></span><br><span class="line"></span><br><span class="line">    FB_msg_packet[<span class="number">0</span>] = <span class="number">0x80</span> | <span class="number">1</span>;  <span class="comment">// version=2, Generic NACK</span></span><br><span class="line">    FB_msg_packet[<span class="number">1</span>] = <span class="number">205</span>;       <span class="comment">// RTPFB</span></span><br><span class="line">    FB_msg_packet[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">    FB_msg_packet[<span class="number">3</span>] = <span class="number">3</span>;         <span class="comment">//length = 3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// SSRC of packet sender</span></span><br><span class="line">    FB_msg_packet[<span class="number">4</span>] = <span class="number">0xde</span>;      </span><br><span class="line">    FB_msg_packet[<span class="number">5</span>] = <span class="number">0xad</span>;</span><br><span class="line">    FB_msg_packet[<span class="number">6</span>] = <span class="number">0xbe</span>;</span><br><span class="line">    FB_msg_packet[<span class="number">7</span>] = <span class="number">0xef</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//SSRC of media source</span></span><br><span class="line">    FB_msg_packet[<span class="number">8</span>] = (srcId &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>;      </span><br><span class="line">    FB_msg_packet[<span class="number">9</span>] = (srcId &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    FB_msg_packet[<span class="number">10</span>] = (srcId &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    FB_msg_packet[<span class="number">11</span>] = (srcId &amp; <span class="number">0xff</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//lost packet ID</span></span><br><span class="line">    FB_msg_packet[<span class="number">12</span>] = (seqNo &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;</span><br><span class="line">    FB_msg_packet[<span class="number">13</span>] = (seqNo &amp; <span class="number">0xff</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//BLP</span></span><br><span class="line">    FB_msg_packet[<span class="number">14</span>] = (blp &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>;        </span><br><span class="line">    FB_msg_packet[<span class="number">15</span>] = (blp &amp; <span class="number">0xff</span>);</span><br><span class="line"></span><br><span class="line">    net_session_write(&amp;rtp-&gt;rtcp_net, FB_msg_packet, <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="其他格式"><a href="#其他格式" class="headerlink" title="其他格式"></a>其他格式</h2><h3 id="SR-Sender-Report-RTCP-Packet"><a href="#SR-Sender-Report-RTCP-Packet" class="headerlink" title="SR: Sender Report RTCP Packet"></a>SR: Sender Report RTCP Packet</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">0                   1                   2                   3</span><br><span class="line">        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">header |V=2|P|    RC   |   PT=SR=200   |             length            |</span><br><span class="line">       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">       |                         SSRC of sender                        |</span><br><span class="line">       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span><br><span class="line">sender |              NTP timestamp, most significant word             |</span><br><span class="line">info   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">       |             NTP timestamp, least significant word             |</span><br><span class="line">       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">       |                         RTP timestamp                         |</span><br><span class="line">       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">       |                     sender&apos;s packet count                     |</span><br><span class="line">       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">       |                      sender&apos;s octet count                     |</span><br><span class="line">       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span><br><span class="line">report |                 SSRC_1 (SSRC of first source)                 |</span><br><span class="line">block  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">  1    | fraction lost |       cumulative number of packets lost       |</span><br><span class="line">       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">       |           extended highest sequence number received           |</span><br><span class="line">       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">       |                      interarrival jitter                      |</span><br><span class="line">       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">       |                         last SR (LSR)                         |</span><br><span class="line">       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">       |                   delay since last SR (DLSR)                  |</span><br><span class="line">       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span><br><span class="line">report |                 SSRC_2 (SSRC of second source)                |</span><br><span class="line">block  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">  2    :                               ...                             :</span><br><span class="line">       +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span><br><span class="line">       |                  profile-specific extensions                  |</span><br><span class="line">       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure><h3 id="RR-Receiver-Report-RTCP-Packet"><a href="#RR-Receiver-Report-RTCP-Packet" class="headerlink" title="RR: Receiver Report RTCP Packet"></a>RR: Receiver Report RTCP Packet</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">0                   1                   2                   3</span><br><span class="line">      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">header |V=2|P|    RC   |   PT=RR=201   |             length            |</span><br><span class="line">     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">     |                     SSRC of packet sender                     |</span><br><span class="line">     +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span><br><span class="line">report |                 SSRC_1 (SSRC of first source)                 |</span><br><span class="line">block  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">1    | fraction lost |       cumulative number of packets lost       |</span><br><span class="line">     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">     |           extended highest sequence number received           |</span><br><span class="line">     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">     |                      interarrival jitter                      |</span><br><span class="line">     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">     |                         last SR (LSR)                         |</span><br><span class="line">     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">     |                   delay since last SR (DLSR)                  |</span><br><span class="line">     +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span><br><span class="line">report |                 SSRC_2 (SSRC of second source)                |</span><br><span class="line">block  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">2    :                               ...                             :</span><br><span class="line">     +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+</span><br><span class="line">     |                  profile-specific extensions                  |</span><br><span class="line">     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Real-time Transport Control Protocol或RTP Control Protocol或简写RTCP）是实时传输协议（RTP）的一个姐妹协议。RTCP由&lt;a href=&quot;https://tools.ietf.org/html/rfc3550&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;RFC 3550&lt;/a&gt;定义（取代作废的RFC 1889）。RTP 使用一个 偶数 UDP port ；而RTCP 则使用 RTP 的下一个 port，也就是一个奇数 port。RTCP与RTP联合工作，RTP实施实际数据的传输，RTCP则负责将控制包送至电话中的每个人。其主要功能是就RTP正在提供的服务质量(Quality of Service)做出反馈。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;RTCP协议将控制包周期发送给所有连接者，应用与数据包相同的分布机制。低层协议提供数据与控制包的复用，如使用单独的UDP端口号。&lt;/p&gt;
&lt;p&gt;作用:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;主要是提供数据发布的质量反馈&lt;/li&gt;
&lt;li&gt;RTCP带有称作规范名字（CNAME）的RTP源持久传输层标识&lt;/li&gt;
&lt;li&gt;传送最小连接控制信息，如参加者辨识&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="多媒体" scheme="http://winddoing.github.io/categories/%E5%A4%9A%E5%AA%92%E4%BD%93/"/>
    
      <category term="传输" scheme="http://winddoing.github.io/categories/%E5%A4%9A%E5%AA%92%E4%BD%93/%E4%BC%A0%E8%BE%93/"/>
    
    
      <category term="rtcp" scheme="http://winddoing.github.io/tags/rtcp/"/>
    
  </entry>
  
  <entry>
    <title>wpa_supplicant源码分析--conf配置文件</title>
    <link href="http://winddoing.github.io/post/50085.html"/>
    <id>http://winddoing.github.io/post/50085.html</id>
    <published>2018-11-28T08:00:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>解析wpa_supplicant的配置文件，一般叫做 <code>wpa_supplicant.conf</code></p><p>在wpa_supplicant的源码中都有配置文件的示例<a href="http://w1.fi/cgit/hostap/plain/wpa_supplicant/wpa_supplicant.conf" target="_blank" rel="noopener">wpa_supplicant.conf</a></p><a id="more"></a><h2 id="wpa-supplicant-conf"><a href="#wpa-supplicant-conf" class="headerlink" title="wpa_supplicant.conf"></a>wpa_supplicant.conf</h2><p>当前项目中使用到的一个配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ctrl_interface=/var/run/sockets</span><br><span class="line">driver_param=use_p2p_group_interface=1p2p_device=1</span><br><span class="line">update_config=1</span><br><span class="line">device_name=V_9ca2</span><br><span class="line">device_type=10-0050F204-5</span><br><span class="line">config_methods=virtual_push_button physical_display keypad</span><br><span class="line">p2p_go_intent=15</span><br><span class="line">p2p_ssid_postfix=-V_9ca2</span><br><span class="line">persistent_reconnect=1</span><br><span class="line"></span><br><span class="line">network=&#123;</span><br><span class="line">  ssid=&quot;D-H-V_9ca2&quot;</span><br><span class="line">  bssid=ae:83:f3:b4:9c:a2</span><br><span class="line">  psk=&quot;00000000&quot;</span><br><span class="line">  proto=RSN</span><br><span class="line">  key_mgmt=WPA-PSK</span><br><span class="line">  pairwise=CCMP</span><br><span class="line">  auth_alg=OPEN</span><br><span class="line">  mode=3</span><br><span class="line">  disabled=2</span><br><span class="line">  p2p_client_list=1a:f0:e4:87:fb:74 ac:83:f3:b3:72:24 04:e6:76:c3:37:84</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>该配置文件用于p2p</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpa_supplicant -iwlan0 -s -Dnl80211 -O/var/run/sockets -c/etc/wifi/p2p_supplicant.conf</span><br></pre></td></tr></table></figure><ul><li><code>-D</code>: 指定使用的wifi驱动, nl80211 = Linux nl80211/cfg80211</li><li><code>-i</code>: 指定端口</li><li><code>-C</code>: 指定配置文件</li><li><code>-O</code>: 覆盖新接口的ctrl_interface参数</li></ul><h2 id="配置文件解析"><a href="#配置文件解析" class="headerlink" title="配置文件解析"></a>配置文件解析</h2><p>以下的数据结构都是从<code>wpa_supplicant_8</code>中的源码获取.</p><blockquote><p><code>8</code>支持建立热点(hostapd)</p></blockquote><h3 id="可配置参数"><a href="#可配置参数" class="headerlink" title="可配置参数"></a>可配置参数</h3><p>wpa_supplicant的所有参数都定义在struct wpa_config中</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * struct wpa_config - wpa_supplicant configuration data</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This data structure is presents the per-interface (radio) configuration</span></span><br><span class="line"><span class="comment"> * data. In many cases, there is only one struct wpa_config instance, but if</span></span><br><span class="line"><span class="comment"> * more than one network interface is being controlled, one instance is used</span></span><br><span class="line"><span class="comment"> * for each.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpa_config</span> &#123;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ssid - Head of the global network list</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is the head for the list of all the configured networks.</span></span><br><span class="line"><span class="comment"> * config文件中，存储所有network节点的链表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpa_ssid</span> *<span class="title">ssid</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pssid - Per-priority network lists (in priority order)</span></span><br><span class="line"><span class="comment"> * 按照priority排列的network节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpa_ssid</span> **<span class="title">pssid</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * num_prio - Number of different priorities used in the pssid lists</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This indicates how many per-priority network lists are included in</span></span><br><span class="line"><span class="comment"> * pssid.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> num_prio;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * cred - Head of the credential list</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is the head for the list of all the configured credentials.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpa_cred</span> *<span class="title">cred</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * eapol_version - IEEE 802.1X/EAPOL version number</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * wpa_supplicant is implemented based on IEEE Std 802.1X-2004 which</span></span><br><span class="line"><span class="comment"> * defines EAPOL version 2. However, there are many APs that do not</span></span><br><span class="line"><span class="comment"> * handle the new version number correctly (they seem to drop the</span></span><br><span class="line"><span class="comment"> * frames completely). In order to make wpa_supplicant interoperate</span></span><br><span class="line"><span class="comment"> * with these APs, the version number is set to 1 by default. This</span></span><br><span class="line"><span class="comment"> * configuration value can be used to set it to the new version (2).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> eapol_version;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ap_scan - AP scanning/selection</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, wpa_supplicant requests driver to perform AP</span></span><br><span class="line"><span class="comment"> * scanning and then uses the scan results to select a</span></span><br><span class="line"><span class="comment"> * suitable AP. Another alternative is to allow the driver to</span></span><br><span class="line"><span class="comment"> * take care of AP scanning and selection and use</span></span><br><span class="line"><span class="comment"> * wpa_supplicant just to process EAPOL frames based on IEEE</span></span><br><span class="line"><span class="comment"> * 802.11 association information from the driver.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1: wpa_supplicant initiates scanning and AP selection (default).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 0: Driver takes care of scanning, AP selection, and IEEE 802.11</span></span><br><span class="line"><span class="comment"> * association parameters (e.g., WPA IE generation); this mode can</span></span><br><span class="line"><span class="comment"> * also be used with non-WPA drivers when using IEEE 802.1X mode;</span></span><br><span class="line"><span class="comment"> * do not try to associate with APs (i.e., external program needs</span></span><br><span class="line"><span class="comment"> * to control association). This mode must also be used when using</span></span><br><span class="line"><span class="comment"> * wired Ethernet drivers.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2: like 0, but associate with APs using security policy and SSID</span></span><br><span class="line"><span class="comment"> * (but not BSSID); this can be used, e.g., with ndiswrapper and NDIS</span></span><br><span class="line"><span class="comment"> * drivers to enable operation with hidden SSIDs and optimized roaming;</span></span><br><span class="line"><span class="comment"> * in this mode, the network blocks in the configuration are tried</span></span><br><span class="line"><span class="comment"> * one by one until the driver reports successful association; each</span></span><br><span class="line"><span class="comment"> * network block should have explicit security policy (i.e., only one</span></span><br><span class="line"><span class="comment"> * option in the lists) for key_mgmt, pairwise, group, proto variables.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> ap_scan;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * disable_scan_offload - Disable automatic offloading of scan requests</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, %wpa_supplicant tries to offload scanning if the driver</span></span><br><span class="line"><span class="comment"> * indicates support for this (sched_scan). This configuration</span></span><br><span class="line"><span class="comment"> * parameter can be used to disable this offloading mechanism.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> disable_scan_offload;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ctrl_interface - Parameters for the control interface</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If this is specified, %wpa_supplicant will open a control interface</span></span><br><span class="line"><span class="comment"> * that is available for external programs to manage %wpa_supplicant.</span></span><br><span class="line"><span class="comment"> * The meaning of this string depends on which control interface</span></span><br><span class="line"><span class="comment"> * mechanism is used. For all cases, the existence of this parameter</span></span><br><span class="line"><span class="comment"> * in configuration is used to determine whether the control interface</span></span><br><span class="line"><span class="comment"> * is enabled.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For UNIX domain sockets (default on Linux and BSD): This is a</span></span><br><span class="line"><span class="comment"> * directory that will be created for UNIX domain sockets for listening</span></span><br><span class="line"><span class="comment"> * to requests from external programs (CLI/GUI, etc.) for status</span></span><br><span class="line"><span class="comment"> * information and configuration. The socket file will be named based</span></span><br><span class="line"><span class="comment"> * on the interface name, so multiple %wpa_supplicant processes can be</span></span><br><span class="line"><span class="comment"> * run at the same time if more than one interface is used.</span></span><br><span class="line"><span class="comment"> * /var/run/wpa_supplicant is the recommended directory for sockets and</span></span><br><span class="line"><span class="comment"> * by default, wpa_cli will use it when trying to connect with</span></span><br><span class="line"><span class="comment"> * %wpa_supplicant.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Access control for the control interface can be configured</span></span><br><span class="line"><span class="comment"> * by setting the directory to allow only members of a group</span></span><br><span class="line"><span class="comment"> * to use sockets. This way, it is possible to run</span></span><br><span class="line"><span class="comment"> * %wpa_supplicant as root (since it needs to change network</span></span><br><span class="line"><span class="comment"> * configuration and open raw sockets) and still allow GUI/CLI</span></span><br><span class="line"><span class="comment"> * components to be run as non-root users. However, since the</span></span><br><span class="line"><span class="comment"> * control interface can be used to change the network</span></span><br><span class="line"><span class="comment"> * configuration, this access needs to be protected in many</span></span><br><span class="line"><span class="comment"> * cases. By default, %wpa_supplicant is configured to use gid</span></span><br><span class="line"><span class="comment"> * 0 (root). If you want to allow non-root users to use the</span></span><br><span class="line"><span class="comment"> * control interface, add a new group and change this value to</span></span><br><span class="line"><span class="comment"> * match with that group. Add users that should have control</span></span><br><span class="line"><span class="comment"> * interface access to this group.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * When configuring both the directory and group, use following format:</span></span><br><span class="line"><span class="comment"> * DIR=/var/run/wpa_supplicant GROUP=wheel</span></span><br><span class="line"><span class="comment"> * DIR=/var/run/wpa_supplicant GROUP=0</span></span><br><span class="line"><span class="comment"> * (group can be either group name or gid)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For UDP connections (default on Windows): The value will be ignored.</span></span><br><span class="line"><span class="comment"> * This variable is just used to select that the control interface is</span></span><br><span class="line"><span class="comment"> * to be created. The value can be set to, e.g., udp</span></span><br><span class="line"><span class="comment"> * (ctrl_interface=udp).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For Windows Named Pipe: This value can be used to set the security</span></span><br><span class="line"><span class="comment"> * descriptor for controlling access to the control interface. Security</span></span><br><span class="line"><span class="comment"> * descriptor can be set using Security Descriptor String Format (see</span></span><br><span class="line"><span class="comment"> * http://msdn.microsoft.com/library/default.asp?url=/library/en-us/secauthz/security/security_descriptor_string_format.asp).</span></span><br><span class="line"><span class="comment"> * The descriptor string needs to be prefixed with SDDL=. For example,</span></span><br><span class="line"><span class="comment"> * ctrl_interface=SDDL=D: would set an empty DACL (which will reject</span></span><br><span class="line"><span class="comment"> * all connections).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *ctrl_interface;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ctrl_interface_group - Control interface group (DEPRECATED)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This variable is only used for backwards compatibility. Group for</span></span><br><span class="line"><span class="comment"> * UNIX domain sockets should now be specified using GROUP=group in</span></span><br><span class="line"><span class="comment"> * ctrl_interface variable.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *ctrl_interface_group;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * fast_reauth - EAP fast re-authentication (session resumption)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, fast re-authentication is enabled for all EAP methods</span></span><br><span class="line"><span class="comment"> * that support it. This variable can be used to disable fast</span></span><br><span class="line"><span class="comment"> * re-authentication (by setting fast_reauth=0). Normally, there is no</span></span><br><span class="line"><span class="comment"> * need to disable fast re-authentication.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> fast_reauth;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * opensc_engine_path - Path to the OpenSSL engine for opensc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is an OpenSSL specific configuration option for loading OpenSC</span></span><br><span class="line"><span class="comment"> * engine (engine_opensc.so); if %NULL, this engine is not loaded.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *opensc_engine_path;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pkcs11_engine_path - Path to the OpenSSL engine for PKCS#11</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is an OpenSSL specific configuration option for loading PKCS#11</span></span><br><span class="line"><span class="comment"> * engine (engine_pkcs11.so); if %NULL, this engine is not loaded.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *pkcs11_engine_path;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pkcs11_module_path - Path to the OpenSSL OpenSC/PKCS#11 module</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is an OpenSSL specific configuration option for configuring</span></span><br><span class="line"><span class="comment"> * path to OpenSC/PKCS#11 engine (opensc-pkcs11.so); if %NULL, this</span></span><br><span class="line"><span class="comment"> * module is not loaded.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *pkcs11_module_path;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pcsc_reader - PC/SC reader name prefix</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If not %NULL, PC/SC reader with a name that matches this prefix is</span></span><br><span class="line"><span class="comment"> * initialized for SIM/USIM access. Empty string can be used to match</span></span><br><span class="line"><span class="comment"> * the first available reader.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *pcsc_reader;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pcsc_pin - PIN for USIM, GSM SIM, and smartcards</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This field is used to configure PIN for SIM/USIM for EAP-SIM and</span></span><br><span class="line"><span class="comment"> * EAP-AKA. If left out, this will be asked through control interface.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *pcsc_pin;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * driver_param - Driver interface parameters</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This text string is passed to the selected driver interface with the</span></span><br><span class="line"><span class="comment"> * optional struct wpa_driver_ops::set_param() handler. This can be</span></span><br><span class="line"><span class="comment"> * used to configure driver specific options without having to add new</span></span><br><span class="line"><span class="comment"> * driver interface functionality.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *driver_param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * dot11RSNAConfigPMKLifetime - Maximum lifetime of a PMK</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * dot11 MIB variable for the maximum lifetime of a PMK in the PMK</span></span><br><span class="line"><span class="comment"> * cache (unit: seconds).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> dot11RSNAConfigPMKLifetime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * dot11RSNAConfigPMKReauthThreshold - PMK re-authentication threshold</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * dot11 MIB variable for the percentage of the PMK lifetime</span></span><br><span class="line"><span class="comment"> * that should expire before an IEEE 802.1X reauthentication occurs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> dot11RSNAConfigPMKReauthThreshold;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * dot11RSNAConfigSATimeout - Security association timeout</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * dot11 MIB variable for the maximum time a security association</span></span><br><span class="line"><span class="comment"> * shall take to set up (unit: seconds).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> dot11RSNAConfigSATimeout;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * update_config - Is wpa_supplicant allowed to update configuration</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This variable control whether wpa_supplicant is allow to re-write</span></span><br><span class="line"><span class="comment"> * its configuration with wpa_config_write(). If this is zero,</span></span><br><span class="line"><span class="comment"> * configuration data is only changed in memory and the external data</span></span><br><span class="line"><span class="comment"> * is not overriden. If this is non-zero, wpa_supplicant will update</span></span><br><span class="line"><span class="comment"> * the configuration data (e.g., a file) whenever configuration is</span></span><br><span class="line"><span class="comment"> * changed. This update may replace the old configuration which can</span></span><br><span class="line"><span class="comment"> * remove comments from it in case of a text file configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> update_config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * blobs - Configuration blobs</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpa_config_blob</span> *<span class="title">blobs</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * uuid - Universally Unique IDentifier (UUID; see RFC 4122) for WPS</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u8 uuid[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * device_name - Device Name (WPS)</span></span><br><span class="line"><span class="comment"> * User-friendly description of device; up to 32 octets encoded in</span></span><br><span class="line"><span class="comment"> * UTF-8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *device_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * manufacturer - Manufacturer (WPS)</span></span><br><span class="line"><span class="comment"> * The manufacturer of the device (up to 64 ASCII characters)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *manufacturer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * model_name - Model Name (WPS)</span></span><br><span class="line"><span class="comment"> * Model of the device (up to 32 ASCII characters)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *model_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * model_number - Model Number (WPS)</span></span><br><span class="line"><span class="comment"> * Additional device description (up to 32 ASCII characters)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *model_number;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * serial_number - Serial Number (WPS)</span></span><br><span class="line"><span class="comment"> * Serial number of the device (up to 32 characters)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *serial_number;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * device_type - Primary Device Type (WPS)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u8 device_type[WPS_DEV_TYPE_LEN];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * config_methods - Config Methods</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is a space-separated list of supported WPS configuration</span></span><br><span class="line"><span class="comment"> * methods. For example, "label virtual_display virtual_push_button</span></span><br><span class="line"><span class="comment"> * keypad".</span></span><br><span class="line"><span class="comment"> * Available methods: usba ethernet label display ext_nfc_token</span></span><br><span class="line"><span class="comment"> * int_nfc_token nfc_interface push_button keypad</span></span><br><span class="line"><span class="comment"> * virtual_display physical_display</span></span><br><span class="line"><span class="comment"> * virtual_push_button physical_push_button.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *config_methods;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * os_version - OS Version (WPS)</span></span><br><span class="line"><span class="comment"> * 4-octet operating system version number</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u8 os_version[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * country - Country code</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is the ISO/IEC alpha2 country code for which we are operating</span></span><br><span class="line"><span class="comment"> * in</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> country[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wps_cred_processing - Credential processing</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   0 = process received credentials internally</span></span><br><span class="line"><span class="comment"> *   1 = do not process received credentials; just pass them over</span></span><br><span class="line"><span class="comment"> *ctrl_iface to external program(s)</span></span><br><span class="line"><span class="comment"> *   2 = process received credentials internally and pass them over</span></span><br><span class="line"><span class="comment"> *ctrl_iface to external program(s)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> wps_cred_processing;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SEC_DEVICE_TYPES 5</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sec_device_types - Secondary Device Types (P2P)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u8 sec_device_type[MAX_SEC_DEVICE_TYPES][WPS_DEV_TYPE_LEN];</span><br><span class="line"><span class="keyword">int</span> num_sec_device_types;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> p2p_listen_reg_class;</span><br><span class="line"><span class="keyword">int</span> p2p_listen_channel;</span><br><span class="line"><span class="keyword">int</span> p2p_oper_reg_class;</span><br><span class="line"><span class="keyword">int</span> p2p_oper_channel;</span><br><span class="line"><span class="keyword">int</span> p2p_go_intent;</span><br><span class="line"><span class="keyword">char</span> *p2p_ssid_postfix;</span><br><span class="line"><span class="keyword">int</span> persistent_reconnect;</span><br><span class="line"><span class="keyword">int</span> p2p_intra_bss;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> num_p2p_pref_chan;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">p2p_channel</span> *<span class="title">p2p_pref_chan</span>;</span></span><br><span class="line"><span class="keyword">int</span> p2p_ignore_shared_freq;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpabuf</span> *<span class="title">wps_vendor_ext_m1</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_WPS_VENDOR_EXT 10</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wps_vendor_ext - Vendor extension attributes in WPS</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpabuf</span> *<span class="title">wps_vendor_ext</span>[<span class="title">MAX_WPS_VENDOR_EXT</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * p2p_group_idle - Maximum idle time in seconds for P2P group</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This value controls how long a P2P group is maintained after there</span></span><br><span class="line"><span class="comment"> * is no other members in the group. As a GO, this means no associated</span></span><br><span class="line"><span class="comment"> * stations in the group. As a P2P client, this means no GO seen in</span></span><br><span class="line"><span class="comment"> * scan results. The maximum idle time is specified in seconds with 0</span></span><br><span class="line"><span class="comment"> * indicating no time limit, i.e., the P2P group remains in active</span></span><br><span class="line"><span class="comment"> * state indefinitely until explicitly removed. As a P2P client, the</span></span><br><span class="line"><span class="comment"> * maximum idle time of P2P_MAX_CLIENT_IDLE seconds is enforced, i.e.,</span></span><br><span class="line"><span class="comment"> * this parameter is mainly meant for GO use and for P2P client, it can</span></span><br><span class="line"><span class="comment"> * only be used to reduce the default timeout to smaller value. A</span></span><br><span class="line"><span class="comment"> * special value -1 can be used to configure immediate removal of the</span></span><br><span class="line"><span class="comment"> * group for P2P client role on any disconnection after the data</span></span><br><span class="line"><span class="comment"> * connection has been established.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> p2p_group_idle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * bss_max_count - Maximum number of BSS entries to keep in memory</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> bss_max_count;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * bss_expiration_age - BSS entry age after which it can be expired</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This value controls the time in seconds after which a BSS entry</span></span><br><span class="line"><span class="comment"> * gets removed if it has not been updated or is not in use.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> bss_expiration_age;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * bss_expiration_scan_count - Expire BSS after number of scans</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If the BSS entry has not been seen in this many scans, it will be</span></span><br><span class="line"><span class="comment"> * removed. A value of 1 means that entry is removed after the first</span></span><br><span class="line"><span class="comment"> * scan in which the BSSID is not seen. Larger values can be used</span></span><br><span class="line"><span class="comment"> * to avoid BSS entries disappearing if they are not visible in</span></span><br><span class="line"><span class="comment"> * every scan (e.g., low signal quality or interference).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> bss_expiration_scan_count;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * filter_ssids - SSID-based scan result filtering</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   0 = do not filter scan results</span></span><br><span class="line"><span class="comment"> *   1 = only include configured SSIDs in scan results/BSS table</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> filter_ssids;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * filter_rssi - RSSI-based scan result filtering</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 0 = do not filter scan results</span></span><br><span class="line"><span class="comment"> * -n = filter scan results below -n dBm</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> filter_rssi;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * max_num_sta - Maximum number of STAs in an AP/P2P GO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> max_num_sta;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * freq_list - Array of allowed scan frequencies or %NULL for all</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is an optional zero-terminated array of frequencies in</span></span><br><span class="line"><span class="comment"> * megahertz (MHz) to allow for narrowing scanning range.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> *freq_list;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * scan_cur_freq - Whether to scan only the current channel</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If true, attempt to scan only the current channel if any other</span></span><br><span class="line"><span class="comment"> * VIFs on this radio are already associated on a particular channel.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> scan_cur_freq;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * changed_parameters - Bitmap of changed parameters since last update</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> changed_parameters;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * disassoc_low_ack - Disassocicate stations with massive packet loss</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> disassoc_low_ack;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * interworking - Whether Interworking (IEEE 802.11u) is enabled</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> interworking;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * access_network_type - Access Network Type</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * When Interworking is enabled, scans will be limited to APs that</span></span><br><span class="line"><span class="comment"> * advertise the specified Access Network Type (0..15; with 15</span></span><br><span class="line"><span class="comment"> * indicating wildcard match).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> access_network_type;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * hessid - Homogenous ESS identifier</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If this is set (any octet is non-zero), scans will be used to</span></span><br><span class="line"><span class="comment"> * request response only from BSSes belonging to the specified</span></span><br><span class="line"><span class="comment"> * Homogeneous ESS. This is used only if interworking is enabled.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u8 hessid[ETH_ALEN];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * hs20 - Hotspot 2.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> hs20;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pbc_in_m1 - AP mode WPS probing workaround for PBC with Windows 7</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Windows 7 uses incorrect way of figuring out AP's WPS capabilities</span></span><br><span class="line"><span class="comment"> * by acting as a Registrar and using M1 from the AP. The config</span></span><br><span class="line"><span class="comment"> * methods attribute in that message is supposed to indicate only the</span></span><br><span class="line"><span class="comment"> * configuration method supported by the AP in Enrollee role, i.e., to</span></span><br><span class="line"><span class="comment"> * add an external Registrar. For that case, PBC shall not be used and</span></span><br><span class="line"><span class="comment"> * as such, the PushButton config method is removed from M1 by default.</span></span><br><span class="line"><span class="comment"> * If pbc_in_m1=1 is included in the configuration file, the PushButton</span></span><br><span class="line"><span class="comment"> * config method is left in M1 (if included in config_methods</span></span><br><span class="line"><span class="comment"> * parameter) to allow Windows 7 to use PBC instead of PIN (e.g., from</span></span><br><span class="line"><span class="comment"> * a label in the AP).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> pbc_in_m1;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * autoscan - Automatic scan parameters or %NULL if none</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is an optional set of parameters for automatic scanning</span></span><br><span class="line"><span class="comment"> * within an interface in following format:</span></span><br><span class="line"><span class="comment"> * &lt;autoscan module name&gt;:&lt;module parameters&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *autoscan;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wps_nfc_pw_from_config - NFC Device Password was read from config</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This parameter can be determined whether the NFC Device Password was</span></span><br><span class="line"><span class="comment"> * included in the configuration (1) or generated dynamically (0). Only</span></span><br><span class="line"><span class="comment"> * the former case is re-written back to the configuration file.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> wps_nfc_pw_from_config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wps_nfc_dev_pw_id - NFC Device Password ID for password token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> wps_nfc_dev_pw_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wps_nfc_dh_pubkey - NFC DH Public Key for password token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpabuf</span> *<span class="title">wps_nfc_dh_pubkey</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wps_nfc_dh_privkey - NFC DH Private Key for password token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpabuf</span> *<span class="title">wps_nfc_dh_privkey</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wps_nfc_dev_pw - NFC Device Password for password token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpabuf</span> *<span class="title">wps_nfc_dev_pw</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ext_password_backend - External password backend or %NULL if none</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * format: &lt;backend name&gt;[:&lt;optional backend parameters&gt;]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *ext_password_backend;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * p2p_go_max_inactivity - Timeout in seconds to detect STA inactivity</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This timeout value is used in P2P GO mode to clean up</span></span><br><span class="line"><span class="comment"> * inactive stations.</span></span><br><span class="line"><span class="comment"> * By default: 300 seconds.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> p2p_go_max_inactivity;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hostapd_wmm_ac_params</span> <span class="title">wmm_ac_params</span>[4];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * auto_interworking - Whether to use network selection automatically</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 0 = do not automatically go through Interworking network selection</span></span><br><span class="line"><span class="comment"> *     (i.e., require explicit interworking_select command for this)</span></span><br><span class="line"><span class="comment"> * 1 = perform Interworking network selection if one or more</span></span><br><span class="line"><span class="comment"> *     credentials have been configured and scan did not find a</span></span><br><span class="line"><span class="comment"> *     matching network block</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> auto_interworking;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * p2p_go_ht40 - Default mode for HT40 enable when operating as GO.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This will take effect for p2p_group_add, p2p_connect, and p2p_invite.</span></span><br><span class="line"><span class="comment"> * Note that regulatory constraints and driver capabilities are</span></span><br><span class="line"><span class="comment"> * consulted anyway, so setting it to 1 can't do real harm.</span></span><br><span class="line"><span class="comment"> * By default: 0 (disabled)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> p2p_go_ht40;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * p2p_disabled - Whether P2P operations are disabled for this interface</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> p2p_disabled;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * p2p_no_group_iface - Whether group interfaces can be used</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, wpa_supplicant will create a separate interface for P2P</span></span><br><span class="line"><span class="comment"> * group operations if the driver supports this. This functionality can</span></span><br><span class="line"><span class="comment"> * be disabled by setting this parameter to 1. In that case, the same</span></span><br><span class="line"><span class="comment"> * interface that was used for the P2P management operations is used</span></span><br><span class="line"><span class="comment"> * also for the group operation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> p2p_no_group_iface;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * okc - Whether to enable opportunistic key caching by default</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, OKC is disabled unless enabled by the per-network</span></span><br><span class="line"><span class="comment"> * proactive_key_caching=1 parameter. okc=1 can be used to change this</span></span><br><span class="line"><span class="comment"> * default behavior.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> okc;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pmf - Whether to enable/require PMF by default</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, PMF is disabled unless enabled by the per-network</span></span><br><span class="line"><span class="comment"> * ieee80211w=1 or ieee80211w=2 parameter. pmf=1/2 can be used to change</span></span><br><span class="line"><span class="comment"> * this default behavior.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">enum</span> mfp_options pmf;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sae_groups - Preference list of enabled groups for SAE</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default (if this parameter is not set), the mandatory group 19</span></span><br><span class="line"><span class="comment"> * (ECC group defined over a 256-bit prime order field) is preferred,</span></span><br><span class="line"><span class="comment"> * but other groups are also enabled. If this parameter is set, the</span></span><br><span class="line"><span class="comment"> * groups will be tried in the indicated order.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> *sae_groups;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * dtim_period - Default DTIM period in Beacon intervals</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This parameter can be used to set the default value for network</span></span><br><span class="line"><span class="comment"> * blocks that do not specify dtim_period.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> dtim_period;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * beacon_int - Default Beacon interval in TU</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This parameter can be used to set the default value for network</span></span><br><span class="line"><span class="comment"> * blocks that do not specify beacon_int.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> beacon_int;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ap_vendor_elements: Vendor specific elements for Beacon/ProbeResp</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This parameter can be used to define additional vendor specific</span></span><br><span class="line"><span class="comment"> * elements for Beacon and Probe Response frames in AP/P2P GO mode. The</span></span><br><span class="line"><span class="comment"> * format for these element(s) is a hexdump of the raw information</span></span><br><span class="line"><span class="comment"> * elements (id+len+payload for one or more elements).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpabuf</span> *<span class="title">ap_vendor_elements</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ignore_old_scan_res - Ignore scan results older than request</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The driver may have a cache of scan results that makes it return</span></span><br><span class="line"><span class="comment"> * information that is older than our scan trigger. This parameter can</span></span><br><span class="line"><span class="comment"> * be used to configure such old information to be ignored instead of</span></span><br><span class="line"><span class="comment"> * allowing it to update the internal BSS table.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> ignore_old_scan_res;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * sched_scan_interval -  schedule scan interval</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> sched_scan_interval;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * tdls_external_control - External control for TDLS setup requests</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Enable TDLS mode where external programs are given the control</span></span><br><span class="line"><span class="comment"> * to specify the TDLS link to get established to the driver. The</span></span><br><span class="line"><span class="comment"> * driver requests the TDLS setup to the supplicant only for the</span></span><br><span class="line"><span class="comment"> * specified TDLS peers.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> tdls_external_control;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="network节点"><a href="#network节点" class="headerlink" title="network节点"></a>network节点</h3><p>wpa_supplicant.conf文件中每个network节点都是一个保存的网络, 存储了网络的名称（ssid），密码（psk），加密方式（WPA_PSK），优先级（priority）</p><p>WIFI网络有多种加密方式，每种加密方式（wpa_psk，wep，open，wapi，各种eap等）的节点书写方式都不同，具体可以参考源代码中<a href="http://w1.fi/cgit/hostap/plain/wpa_supplicant/wpa_supplicant.conf" target="_blank" rel="noopener">wpa_supplicant.conf</a>文件</p><p>network节点的结构体<code>struct wpa_ssid</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * struct wpa_ssid - Network configuration data</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This structure includes all the configuration variables for a network. This</span></span><br><span class="line"><span class="comment"> * data is included in the per-interface configuration data as an element of</span></span><br><span class="line"><span class="comment"> * the network list, struct wpa_config::ssid. Each network block in the</span></span><br><span class="line"><span class="comment"> * configuration is mapped to a struct wpa_ssid instance.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpa_ssid</span> &#123;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * next - Next network in global list</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This pointer can be used to iterate over all networks. The head of</span></span><br><span class="line"><span class="comment"> * this list is stored in the ssid field of struct wpa_config.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpa_ssid</span> *<span class="title">next</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pnext - Next network in per-priority list</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This pointer can be used to iterate over all networks in the same</span></span><br><span class="line"><span class="comment"> * priority class. The heads of these list are stored in the pssid</span></span><br><span class="line"><span class="comment"> * fields of struct wpa_config.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">wpa_ssid</span> *<span class="title">pnext</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * id - Unique id for the network</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This identifier is used as a unique identifier for each network</span></span><br><span class="line"><span class="comment"> * block when using the control interface. Each network is allocated an</span></span><br><span class="line"><span class="comment"> * id when it is being created, either when reading the configuration</span></span><br><span class="line"><span class="comment"> * file or when a new network is added through the control interface.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * priority - Priority group</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, all networks will get same priority group (0). If some</span></span><br><span class="line"><span class="comment"> * of the networks are more desirable, this field can be used to change</span></span><br><span class="line"><span class="comment"> * the order in which wpa_supplicant goes through the networks when</span></span><br><span class="line"><span class="comment"> * selecting a BSS. The priority groups will be iterated in decreasing</span></span><br><span class="line"><span class="comment"> * priority (i.e., the larger the priority value, the sooner the</span></span><br><span class="line"><span class="comment"> * network is matched against the scan results). Within each priority</span></span><br><span class="line"><span class="comment"> * group, networks will be selected based on security policy, signal</span></span><br><span class="line"><span class="comment"> * strength, etc.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Please note that AP scanning with scan_ssid=1 and ap_scan=2 mode are</span></span><br><span class="line"><span class="comment"> * not using this priority to select the order for scanning. Instead,</span></span><br><span class="line"><span class="comment"> * they try the networks in the order that used in the configuration</span></span><br><span class="line"><span class="comment"> * file.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> priority;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ssid - Service set identifier (network name)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is the SSID for the network. For wireless interfaces, this is</span></span><br><span class="line"><span class="comment"> * used to select which network will be used. If set to %NULL (or</span></span><br><span class="line"><span class="comment"> * ssid_len=0), any SSID can be used. For wired interfaces, this must</span></span><br><span class="line"><span class="comment"> * be set to %NULL. Note: SSID may contain any characters, even nul</span></span><br><span class="line"><span class="comment"> * (ASCII 0) and as such, this should not be assumed to be a nul</span></span><br><span class="line"><span class="comment"> * terminated string. ssid_len defines how many characters are valid</span></span><br><span class="line"><span class="comment"> * and the ssid field is not guaranteed to be nul terminated.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u8 *ssid;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ssid_len - Length of the SSID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">size_t</span> ssid_len;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * bssid - BSSID</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If set, this network block is used only when associating with the AP</span></span><br><span class="line"><span class="comment"> * using the configured BSSID</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If this is a persistent P2P group (disabled == 2), this is the GO</span></span><br><span class="line"><span class="comment"> * Device Address.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u8 bssid[ETH_ALEN];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * bssid_set - Whether BSSID is configured for this network</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> bssid_set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * psk - WPA pre-shared key (256 bits)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u8 psk[<span class="number">32</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * psk_set - Whether PSK field is configured</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> psk_set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * passphrase - WPA ASCII passphrase</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If this is set, psk will be generated using the SSID and passphrase</span></span><br><span class="line"><span class="comment"> * configured for the network. ASCII passphrase must be between 8 and</span></span><br><span class="line"><span class="comment"> * 63 characters (inclusive).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *passphrase;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ext_psk - PSK/passphrase name in external storage</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If this is set, PSK/passphrase will be fetched from external storage</span></span><br><span class="line"><span class="comment"> * when requesting association with the network.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *ext_psk;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pairwise_cipher - Bitfield of allowed pairwise ciphers, WPA_CIPHER_*</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> pairwise_cipher;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * group_cipher - Bitfield of allowed group ciphers, WPA_CIPHER_*</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> group_cipher;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * key_mgmt - Bitfield of allowed key management protocols</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * WPA_KEY_MGMT_*</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> key_mgmt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * bg_scan_period - Background scan period in seconds, 0 to disable, or</span></span><br><span class="line"><span class="comment"> * -1 to indicate no change to default driver configuration</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> bg_scan_period;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * proto - Bitfield of allowed protocols, WPA_PROTO_*</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> proto;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * auth_alg -  Bitfield of allowed authentication algorithms</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * WPA_AUTH_ALG_*</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> auth_alg;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * scan_ssid - Scan this SSID with Probe Requests</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * scan_ssid can be used to scan for APs using hidden SSIDs.</span></span><br><span class="line"><span class="comment"> * Note: Many drivers do not support this. ap_mode=2 can be used with</span></span><br><span class="line"><span class="comment"> * such drivers to use hidden SSIDs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> scan_ssid;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> IEEE8021X_EAPOL</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EAPOL_FLAG_REQUIRE_KEY_UNICAST BIT(0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EAPOL_FLAG_REQUIRE_KEY_BROADCAST BIT(1)</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * eapol_flags - Bit field of IEEE 802.1X/EAPOL options (EAPOL_FLAG_*)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> eapol_flags;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * eap - EAP peer configuration for this network</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eap_peer_config</span> <span class="title">eap</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* IEEE8021X_EAPOL */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUM_WEP_KEYS 4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_WEP_KEY_LEN 16</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wep_key - WEP keys</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u8 wep_key[NUM_WEP_KEYS][MAX_WEP_KEY_LEN];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wep_key_len - WEP key lengths</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">size_t</span> wep_key_len[NUM_WEP_KEYS];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wep_tx_keyidx - Default key index for TX frames using WEP</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> wep_tx_keyidx;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * proactive_key_caching - Enable proactive key caching</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This field can be used to enable proactive key caching which is also</span></span><br><span class="line"><span class="comment"> * known as opportunistic PMKSA caching for WPA2. This is disabled (0)</span></span><br><span class="line"><span class="comment"> * by default unless default value is changed with the global okc=1</span></span><br><span class="line"><span class="comment"> * parameter. Enable by setting this to 1.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Proactive key caching is used to make supplicant assume that the APs</span></span><br><span class="line"><span class="comment"> * are using the same PMK and generate PMKSA cache entries without</span></span><br><span class="line"><span class="comment"> * doing RSN pre-authentication. This requires support from the AP side</span></span><br><span class="line"><span class="comment"> * and is normally used with wireless switches that co-locate the</span></span><br><span class="line"><span class="comment"> * authenticator.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Internally, special value -1 is used to indicate that the parameter</span></span><br><span class="line"><span class="comment"> * was not specified in the configuration (i.e., default behavior is</span></span><br><span class="line"><span class="comment"> * followed).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> proactive_key_caching;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * mixed_cell - Whether mixed cells are allowed</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This option can be used to configure whether so called mixed cells,</span></span><br><span class="line"><span class="comment"> * i.e., networks that use both plaintext and encryption in the same</span></span><br><span class="line"><span class="comment"> * SSID, are allowed. This is disabled (0) by default. Enable by</span></span><br><span class="line"><span class="comment"> * setting this to 1.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> mixed_cell;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> IEEE8021X_EAPOL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * leap - Number of EAP methods using LEAP</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This field should be set to 1 if LEAP is enabled. This is used to</span></span><br><span class="line"><span class="comment"> * select IEEE 802.11 authentication algorithm.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> leap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * non_leap - Number of EAP methods not using LEAP</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This field should be set to &gt;0 if any EAP method other than LEAP is</span></span><br><span class="line"><span class="comment"> * enabled. This is used to select IEEE 802.11 authentication</span></span><br><span class="line"><span class="comment"> * algorithm.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> non_leap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * eap_workaround - EAP workarounds enabled</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * wpa_supplicant supports number of "EAP workarounds" to work around</span></span><br><span class="line"><span class="comment"> * interoperability issues with incorrectly behaving authentication</span></span><br><span class="line"><span class="comment"> * servers. This is recommended to be enabled by default because some</span></span><br><span class="line"><span class="comment"> * of the issues are present in large number of authentication servers.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Strict EAP conformance mode can be configured by disabling</span></span><br><span class="line"><span class="comment"> * workarounds with eap_workaround = 0.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> eap_workaround;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* IEEE8021X_EAPOL */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * mode - IEEE 802.11 operation mode (Infrastucture/IBSS)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 0 = infrastructure (Managed) mode, i.e., associate with an AP.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1 = IBSS (ad-hoc, peer-to-peer)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2 = AP (access point)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 3 = P2P Group Owner (can be set in the configuration file)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 4 = P2P Group Formation (used internally; not in configuration</span></span><br><span class="line"><span class="comment"> * files)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Note: IBSS can only be used with key_mgmt NONE (plaintext and</span></span><br><span class="line"><span class="comment"> * static WEP) and key_mgmt=WPA-NONE (fixed group key TKIP/CCMP). In</span></span><br><span class="line"><span class="comment"> * addition, ap_scan has to be set to 2 for IBSS. WPA-None requires</span></span><br><span class="line"><span class="comment"> * following network block options: proto=WPA, key_mgmt=WPA-NONE,</span></span><br><span class="line"><span class="comment"> * pairwise=NONE, group=TKIP (or CCMP, but not both), and psk must also</span></span><br><span class="line"><span class="comment"> * be set (either directly or using ASCII passphrase).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">enum</span> wpas_mode &#123;</span><br><span class="line">WPAS_MODE_INFRA = <span class="number">0</span>,</span><br><span class="line">WPAS_MODE_IBSS = <span class="number">1</span>,</span><br><span class="line">WPAS_MODE_AP = <span class="number">2</span>,</span><br><span class="line">WPAS_MODE_P2P_GO = <span class="number">3</span>,</span><br><span class="line">WPAS_MODE_P2P_GROUP_FORMATION = <span class="number">4</span>,</span><br><span class="line">&#125; mode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * disabled - Whether this network is currently disabled</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 0 = this network can be used (default).</span></span><br><span class="line"><span class="comment"> * 1 = this network block is disabled (can be enabled through</span></span><br><span class="line"><span class="comment"> * ctrl_iface, e.g., with wpa_cli or wpa_gui).</span></span><br><span class="line"><span class="comment"> * 2 = this network block includes parameters for a persistent P2P</span></span><br><span class="line"><span class="comment"> * group (can be used with P2P ctrl_iface commands)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> disabled;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * disabled_for_connect - Whether this network was temporarily disabled</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This flag is used to reenable all the temporarily disabled networks</span></span><br><span class="line"><span class="comment"> * after either the success or failure of a WPS connection.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> disabled_for_connect;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * peerkey -  Whether PeerKey handshake for direct links is allowed</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is only used when both RSN/WPA2 and IEEE 802.11e (QoS) are</span></span><br><span class="line"><span class="comment"> * enabled.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 0 = disabled (default)</span></span><br><span class="line"><span class="comment"> * 1 = enabled</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> peerkey;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * id_str - Network identifier string for external scripts</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This value is passed to external ctrl_iface monitors in</span></span><br><span class="line"><span class="comment"> * WPA_EVENT_CONNECTED event and wpa_cli sets this as WPA_ID_STR</span></span><br><span class="line"><span class="comment"> * environment variable for action scripts.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *id_str;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_IEEE80211W</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ieee80211w - Whether management frame protection is enabled</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This value is used to configure policy for management frame</span></span><br><span class="line"><span class="comment"> * protection (IEEE 802.11w). 0 = disabled, 1 = optional, 2 = required.</span></span><br><span class="line"><span class="comment"> * This is disabled by default unless the default value has been changed</span></span><br><span class="line"><span class="comment"> * with the global pmf=1/2 parameter.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Internally, special value 3 is used to indicate that the parameter</span></span><br><span class="line"><span class="comment"> * was not specified in the configuration (i.e., default behavior is</span></span><br><span class="line"><span class="comment"> * followed).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">enum</span> mfp_options ieee80211w;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_IEEE80211W */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * frequency - Channel frequency in megahertz (MHz) for IBSS</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This value is used to configure the initial channel for IBSS (adhoc)</span></span><br><span class="line"><span class="comment"> * networks, e.g., 2412 = IEEE 802.11b/g channel 1. It is ignored in</span></span><br><span class="line"><span class="comment"> * the infrastructure mode. In addition, this value is only used by the</span></span><br><span class="line"><span class="comment"> * station that creates the IBSS. If an IBSS network with the</span></span><br><span class="line"><span class="comment"> * configured SSID is already present, the frequency of the network</span></span><br><span class="line"><span class="comment"> * will be used instead of this configured value.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> frequency;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ht40;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * wpa_ptk_rekey - Maximum lifetime for PTK in seconds</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This value can be used to enforce rekeying of PTK to mitigate some</span></span><br><span class="line"><span class="comment"> * attacks against TKIP deficiencies.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> wpa_ptk_rekey;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * scan_freq - Array of frequencies to scan or %NULL for all</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is an optional zero-terminated array of frequencies in</span></span><br><span class="line"><span class="comment"> * megahertz (MHz) to include in scan requests when searching for this</span></span><br><span class="line"><span class="comment"> * network. This can be used to speed up scanning when the network is</span></span><br><span class="line"><span class="comment"> * known to not use all possible channels.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> *scan_freq;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * bgscan - Background scan and roaming parameters or %NULL if none</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is an optional set of parameters for background scanning and</span></span><br><span class="line"><span class="comment"> * roaming within a network (ESS) in following format:</span></span><br><span class="line"><span class="comment"> * &lt;bgscan module name&gt;:&lt;module parameters&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *bgscan;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ignore_broadcast_ssid - Hide SSID in AP mode</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Send empty SSID in beacons and ignore probe request frames that do</span></span><br><span class="line"><span class="comment"> * not specify full SSID, i.e., require stations to know SSID.</span></span><br><span class="line"><span class="comment"> * default: disabled (0)</span></span><br><span class="line"><span class="comment"> * 1 = send empty (length=0) SSID in beacon and ignore probe request</span></span><br><span class="line"><span class="comment"> * for broadcast SSID</span></span><br><span class="line"><span class="comment"> * 2 = clear SSID (ASCII 0), but keep the original length (this may be</span></span><br><span class="line"><span class="comment"> * required with some clients that do not support empty SSID) and</span></span><br><span class="line"><span class="comment"> * ignore probe requests for broadcast SSID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> ignore_broadcast_ssid;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * freq_list - Array of allowed frequencies or %NULL for all</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is an optional zero-terminated array of frequencies in</span></span><br><span class="line"><span class="comment"> * megahertz (MHz) to allow for selecting the BSS. If set, scan results</span></span><br><span class="line"><span class="comment"> * that do not match any of the specified frequencies are not</span></span><br><span class="line"><span class="comment"> * considered when selecting a BSS.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> *freq_list;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * p2p_client_list - List of P2P Clients in a persistent group (GO)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is a list of P2P Clients (P2P Device Address) that have joined</span></span><br><span class="line"><span class="comment"> * the persistent group. This is maintained on the GO for persistent</span></span><br><span class="line"><span class="comment"> * group entries (disabled == 2).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u8 *p2p_client_list;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * num_p2p_clients - Number of entries in p2p_client_list</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">size_t</span> num_p2p_clients;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> P2P_MAX_STORED_CLIENTS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> P2P_MAX_STORED_CLIENTS 100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* P2P_MAX_STORED_CLIENTS */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * psk_list - Per-client PSKs (struct psk_list_entry)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dl_list</span> <span class="title">psk_list</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * p2p_group - Network generated as a P2P group (used internally)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> p2p_group;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * p2p_persistent_group - Whether this is a persistent group</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> p2p_persistent_group;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * temporary - Whether this network is temporary and not to be saved</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> temporary;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * export_keys - Whether keys may be exported</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This attribute will be set when keys are determined through</span></span><br><span class="line"><span class="comment"> * WPS or similar so that they may be exported.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> export_keys;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> ANDROID_P2P</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * assoc_retry - Number of times association should be retried.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> assoc_retry;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_HT_OVERRIDES</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * disable_ht - Disable HT (IEEE 802.11n) for this network</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, use it if it is available, but this can be configured</span></span><br><span class="line"><span class="comment"> * to 1 to have it disabled.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> disable_ht;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * disable_ht40 - Disable HT40 for this network</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, use it if it is available, but this can be configured</span></span><br><span class="line"><span class="comment"> * to 1 to have it disabled.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> disable_ht40;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * disable_sgi - Disable SGI (Short Guard Interval) for this network</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, use it if it is available, but this can be configured</span></span><br><span class="line"><span class="comment"> * to 1 to have it disabled.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> disable_sgi;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * disable_max_amsdu - Disable MAX A-MSDU</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * A-MDSU will be 3839 bytes when disabled, or 7935</span></span><br><span class="line"><span class="comment"> * when enabled (assuming it is otherwise supported)</span></span><br><span class="line"><span class="comment"> * -1 (default) means do not apply any settings to the kernel.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> disable_max_amsdu;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ampdu_factor - Maximum A-MPDU Length Exponent</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Value: 0-3, see 7.3.2.56.3 in IEEE Std 802.11n-2009.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> ampdu_factor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ampdu_density - Minimum A-MPDU Start Spacing</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Value: 0-7, see 7.3.2.56.3 in IEEE Std 802.11n-2009.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> ampdu_density;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ht_mcs - Allowed HT-MCS rates, in ASCII hex: ffff0000...</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default (empty string): Use whatever the OS has configured.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">char</span> *ht_mcs;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_HT_OVERRIDES */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_VHT_OVERRIDES</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * disable_vht - Disable VHT (IEEE 802.11ac) for this network</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * By default, use it if it is available, but this can be configured</span></span><br><span class="line"><span class="comment"> * to 1 to have it disabled.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> disable_vht;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * vht_capa - VHT capabilities to use</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> vht_capa;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * vht_capa_mask - mask for VHT capabilities</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> vht_capa_mask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> vht_rx_mcs_nss_1, vht_rx_mcs_nss_2,</span><br><span class="line">    vht_rx_mcs_nss_3, vht_rx_mcs_nss_4,</span><br><span class="line">    vht_rx_mcs_nss_5, vht_rx_mcs_nss_6,</span><br><span class="line">    vht_rx_mcs_nss_7, vht_rx_mcs_nss_8;</span><br><span class="line"><span class="keyword">int</span> vht_tx_mcs_nss_1, vht_tx_mcs_nss_2,</span><br><span class="line">    vht_tx_mcs_nss_3, vht_tx_mcs_nss_4,</span><br><span class="line">    vht_tx_mcs_nss_5, vht_tx_mcs_nss_6,</span><br><span class="line">    vht_tx_mcs_nss_7, vht_tx_mcs_nss_8;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* CONFIG_VHT_OVERRIDES */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ap_max_inactivity - Timeout in seconds to detect STA's inactivity</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This timeout value is used in AP mode to clean up inactive stations.</span></span><br><span class="line"><span class="comment"> * By default: 300 seconds.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> ap_max_inactivity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * dtim_period - DTIM period in Beacon intervals</span></span><br><span class="line"><span class="comment"> * By default: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> dtim_period;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * beacon_int - Beacon interval (default: 100 TU)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> beacon_int;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * auth_failures - Number of consecutive authentication failures</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> auth_failures;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * disabled_until - Network block disabled until this time if non-zero</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">os_time</span> <span class="title">disabled_until</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * parent_cred - Pointer to parent wpa_cred entry</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This pointer can be used to delete temporary networks when a wpa_cred</span></span><br><span class="line"><span class="comment"> * that was used to create them is removed. This pointer should not be</span></span><br><span class="line"><span class="comment"> * dereferences since it may not be updated in all cases.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> *parent_cred;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;解析wpa_supplicant的配置文件，一般叫做 &lt;code&gt;wpa_supplicant.conf&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;在wpa_supplicant的源码中都有配置文件的示例&lt;a href=&quot;http://w1.fi/cgit/hostap/plain/wpa_supplicant/wpa_supplicant.conf&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;wpa_supplicant.conf&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="网络" scheme="http://winddoing.github.io/categories/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="WIFI" scheme="http://winddoing.github.io/categories/%E7%BD%91%E7%BB%9C/WIFI/"/>
    
    
      <category term="WIFI" scheme="http://winddoing.github.io/tags/WIFI/"/>
    
  </entry>
  
  <entry>
    <title>linux下shell基础--获取脚本路径</title>
    <link href="http://winddoing.github.io/post/12156.html"/>
    <id>http://winddoing.github.io/post/12156.html</id>
    <published>2018-11-24T06:21:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p>在执行脚本时我们或多或少的都要知道当前所在的路径,或者脚本存放的路径,记录几个常用的获取<code>路径</code>的方法</p><a id="more"></a><h2 id="脚本路径"><a href="#脚本路径" class="headerlink" title="脚本路径"></a>脚本路径</h2><h3 id="cd-dirname-0-pwd"><a href="#cd-dirname-0-pwd" class="headerlink" title="$(cd dirname $0;pwd)"></a>$(cd <code>dirname $0</code>;pwd)</h3><blockquote><p>获取当前<code>脚本</code>所在的<code>绝对路径</code></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">basepath=$(cd `dirname $0`; pwd)</span><br></pre></td></tr></table></figure><ul><li><code>dirname $0</code> :取得当前执行脚本文件的父目录</li></ul><h3 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h3><blockquote><p>获取当前<code>执行脚本</code>的所在的<code>绝对路径</code></p></blockquote><h3 id="readlink-f-dirname-0"><a href="#readlink-f-dirname-0" class="headerlink" title="$(readlink -f $(dirname $0))"></a>$(readlink -f $(dirname $0))</h3><blockquote><p>获取当前<code>脚本</code>所在的<code>相对路径`</code></p></blockquote><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote><p>xxx:主机名</p></blockquote><ul><li>测试脚本</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">basepath1=`pwd`</span><br><span class="line">basepath2=$(cd `dirname $0`; pwd)</span><br><span class="line">basepath3=$(readlink -f $(dirname $0))</span><br><span class="line">basepath4=$(dirname $0)</span><br><span class="line">basepath5=$(dirname $(readlink -f $0))</span><br><span class="line"></span><br><span class="line">echo &quot;basepath1= $basepath1&quot;</span><br><span class="line">echo &quot;basepath2= $basepath2&quot;</span><br><span class="line">echo &quot;basepath3= $basepath3&quot;</span><br><span class="line">echo &quot;basepath4= $basepath4&quot;</span><br><span class="line">echo &quot;basepath5= $basepath5&quot;</span><br></pre></td></tr></table></figure><ul><li>测试环境</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">14:47 [xxx@xxx-pc]~/test</span><br><span class="line">=====&gt;$ls -l a.sh</span><br><span class="line">lrwxrwxrwx 1 xxx xxx 13 11月 24 14:42 a.sh -&gt; aa/bb/cc/a.sh</span><br></pre></td></tr></table></figure><ul><li>执行脚本</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">14:48 [xxx@xxx-pc]~</span><br><span class="line">=====&gt;$./test/a.sh</span><br><span class="line">basepath1= /home/xxx</span><br><span class="line">basepath2= /home/xxx/test</span><br><span class="line">basepath3= /home/xxx/test</span><br><span class="line">basepath4= ./test</span><br><span class="line">basepath5= /home/xxx/test/aa/bb/cc</span><br></pre></td></tr></table></figure><h2 id="readlink"><a href="#readlink" class="headerlink" title="readlink"></a>readlink</h2><blockquote><p>用来找出符号链接所指向的位置</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$readlink .vimrc</span><br><span class="line">/home/xxx/.work_env/vim/vimrc</span><br></pre></td></tr></table></figure><ul><li><code>-f</code>: 递归跟随给出文件名的所有符号链接以标准化，除最后一个外所有组件必须存在。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在执行脚本时我们或多或少的都要知道当前所在的路径,或者脚本存放的路径,记录几个常用的获取&lt;code&gt;路径&lt;/code&gt;的方法&lt;/p&gt;
    
    </summary>
    
      <category term="shell" scheme="http://winddoing.github.io/categories/shell/"/>
    
    
      <category term="Shell" scheme="http://winddoing.github.io/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>代码风格格式化--Astyle</title>
    <link href="http://winddoing.github.io/post/62371.html"/>
    <id>http://winddoing.github.io/post/62371.html</id>
    <published>2018-11-22T06:01:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<p><code>Astyle</code>是一个用来对C/C++代码进行格式化</p><blockquote><p>文档: <a href="http://astyle.sourceforge.net/astyle.html" target="_blank" rel="noopener">Artistic Style 3.1</a></p></blockquote><a id="more"></a><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sudo apt install astyle</span><br></pre></td></tr></table></figure><h2 id="预定风格"><a href="#预定风格" class="headerlink" title="预定风格"></a>预定风格</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">default brace style</span><br><span class="line">If no brace style is requested, the opening braces will not be</span><br><span class="line">changed and closing braces will be broken from the preceding line.</span><br><span class="line"></span><br><span class="line">--style=allman  OR  --style=bsd  OR  --style=break  OR  -A1</span><br><span class="line">Allman style formatting/indenting.</span><br><span class="line">Broken braces.</span><br><span class="line"></span><br><span class="line">--style=java  OR  --style=attach  OR  -A2</span><br><span class="line">Java style formatting/indenting.</span><br><span class="line">Attached braces.</span><br><span class="line"></span><br><span class="line">--style=kr  OR  --style=k&amp;r  OR  --style=k/r  OR  -A3</span><br><span class="line">Kernighan &amp; Ritchie style formatting/indenting.</span><br><span class="line">Linux braces.</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">--style=gnu  OR  -A7</span><br><span class="line">GNU style formatting/indenting.</span><br><span class="line">Broken braces, indented blocks.</span><br><span class="line"></span><br><span class="line">--style=linux  OR  --style=knf  OR  -A8</span><br><span class="line">Linux style formatting/indenting.</span><br><span class="line">Linux braces, minimum conditional indent is one-half indent.</span><br><span class="line"></span><br><span class="line">--style=horstmann  OR  --style=run-in  OR  -A9</span><br><span class="line">Horstmann style formatting/indenting.</span><br><span class="line">Run-in braces, indented switches.</span><br><span class="line"></span><br><span class="line">--style=1tbs  OR  --style=otbs  OR  -A10</span><br><span class="line">One True Brace Style formatting/indenting.</span><br><span class="line">Linux braces, add braces to all conditionals.</span><br><span class="line"></span><br><span class="line">--style=google  OR  -A14</span><br><span class="line">Google style formatting/indenting.</span><br><span class="line">Attached braces, indented class modifiers.</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">astyle --style=linux -n ./*.c</span><br></pre></td></tr></table></figure><ul><li><code>--style=linux</code> : linux风格缩进</li><li><code>-n</code> : 不保存备份</li></ul><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;astyle --style=linux --indent=force-tab=4 --convert-tabs --pad-oper --unpad-paren --break-blocks=all --delete-empty-lines *.c *.h</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><h3 id="递归格式化"><a href="#递归格式化" class="headerlink" title="递归格式化"></a>递归格式化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">astyle --style=linux --recursive *.c,*.h</span><br></pre></td></tr></table></figure><blockquote><p>必须中间加<code>,</code></p></blockquote><h2 id="自定义规则"><a href="#自定义规则" class="headerlink" title="自定义规则"></a>自定义规则</h2><blockquote><p>在<code>--style=linux</code>的基础上修改,只做必要改动</p></blockquote><h3 id="缩进Tab"><a href="#缩进Tab" class="headerlink" title="缩进Tab"></a>缩进Tab</h3><p>默认tab是4个空格.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--indent=force-tab=#  OR  -T#</span><br></pre></td></tr></table></figure><blockquote><p>优先采用空格缩进, 这样配置后同vim中的tab缩进配置4个空格相同,格式化后的代码相当于vim中的<code>gg=G</code></p></blockquote><h3 id="switch缩进"><a href="#switch缩进" class="headerlink" title="switch缩进"></a>switch缩进</h3><p>默认</p><h3 id="操作符两边加空格"><a href="#操作符两边加空格" class="headerlink" title="操作符两边加空格"></a>操作符两边加空格</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--pad-oper  OR  -p</span><br></pre></td></tr></table></figure><h3 id="删除括号-两边多余空格"><a href="#删除括号-两边多余空格" class="headerlink" title="删除括号()两边多余空格"></a>删除括号()两边多余空格</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--unpad-paren  OR  -U</span><br></pre></td></tr></table></figure><h3 id="空行分隔没有关系的块-类-标签-不包括函数块"><a href="#空行分隔没有关系的块-类-标签-不包括函数块" class="headerlink" title="空行分隔没有关系的块,类,标签(不包括函数块)"></a>空行分隔没有关系的块,类,标签(不包括函数块)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--break-blocks  OR  -f</span><br></pre></td></tr></table></figure><h3 id="空行分隔无关系的块-包括else-catch等"><a href="#空行分隔无关系的块-包括else-catch等" class="headerlink" title="空行分隔无关系的块,包括else catch等"></a>空行分隔无关系的块,包括else catch等</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--break-blocks=all  OR  -F</span><br></pre></td></tr></table></figure><h3 id="删除多余空行"><a href="#删除多余空行" class="headerlink" title="删除多余空行"></a>删除多余空行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--delete-empty-lines  OR  -x</span><br></pre></td></tr></table></figure><h3 id="Tab转换为空格"><a href="#Tab转换为空格" class="headerlink" title="Tab转换为空格"></a>Tab转换为空格</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--convert-tabs  OR  -c</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="http://www.cnblogs.com/tfanalysis/articles/4874793.html" target="_blank" rel="noopener">Astyle编程语言格式化工具的中文说明</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;Astyle&lt;/code&gt;是一个用来对C/C++代码进行格式化&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;文档: &lt;a href=&quot;http://astyle.sourceforge.net/astyle.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Artistic Style 3.1&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="程序设计" scheme="http://winddoing.github.io/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="代码风格" scheme="http://winddoing.github.io/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC/"/>
    
    
      <category term="编码" scheme="http://winddoing.github.io/tags/%E7%BC%96%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>DHCP之udhcpc</title>
    <link href="http://winddoing.github.io/post/18609.html"/>
    <id>http://winddoing.github.io/post/18609.html</id>
    <published>2018-11-20T08:05:00.000Z</published>
    <updated>2019-02-26T07:26:40.414Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>动态主机设置协议（英语：Dynamic Host Configuration Protocol，DHCP）是一个局域网的网络协议，使用UDP协议工作，主要有两个用途：</p><ul><li>用于内部网或网络服务供应商自动分配IP地址；</li><li>给用户用于内部网管理员作为对所有计算机作中央管理的手段。</li></ul></blockquote><p>DHCP从一个IP地址池中提供IP地址，该池有DHCP服务器数据库定义，称为scope。如果客户端接受这一地址，则它可在一个预定义的期限内使用该地址，称为<code>租约</code>。如果客户端无法从DHCP服务器获取IP地址，它就无法正常初始化TCP/IP。</p><p><strong>DHCP采用的C/S架构,客户端有<code>udhcpc</code></strong><br><a id="more"></a></p><h2 id="udhcpc"><a href="#udhcpc" class="headerlink" title="udhcpc"></a>udhcpc</h2><p>busybox中提供的简易的<code>udhcp client</code></p><p>文档:<a href="http://udhcp.busybox.net/README.udhcpc" target="_blank" rel="noopener">http://udhcp.busybox.net/README.udhcpc</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">udhcpc -b -i eth0 -p /var/run/udhcpc.pid</span><br></pre></td></tr></table></figure><ul><li><code>-b</code>:切换到后台指令</li><li><code>-i</code>:指定网络接口</li><li><code>-p</code>:守护进程ID存储在文件中</li><li><code>-s</code>:在DHCP的event中,执行脚本(default:/usr/share/udhcpc/default.script)</li></ul><h2 id="udhcpc执行脚本"><a href="#udhcpc执行脚本" class="headerlink" title="udhcpc执行脚本"></a>udhcpc执行脚本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">[ -z &quot;$1&quot; ] &amp;&amp; echo &quot;Error: should be called from udhcpc&quot; &amp;&amp; exit 1</span><br><span class="line"></span><br><span class="line">RESOLV_CONF=&quot;/etc/resolv.conf&quot;</span><br><span class="line">[ -n &quot;$broadcast&quot; ] &amp;&amp; BROADCAST=&quot;broadcast $broadcast&quot;</span><br><span class="line">[ -n &quot;$subnet&quot; ] &amp;&amp; NETMASK=&quot;netmask $subnet&quot;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">        deconfig)</span><br><span class="line">                /sbin/ifconfig $interface 0.0.0.0</span><br><span class="line">                ;;</span><br><span class="line"></span><br><span class="line">        renew|bound)</span><br><span class="line">                /sbin/ifconfig $interface $ip $BROADCAST $NETMASK</span><br><span class="line"></span><br><span class="line">                if [ -n &quot;$router&quot; ] ; then</span><br><span class="line">                        echo &quot;deleting routers&quot;</span><br><span class="line">                        while route del default gw 0.0.0.0 dev $interface ; do</span><br><span class="line">                                :</span><br><span class="line">                        done</span><br><span class="line">                        for i in $router ; do</span><br><span class="line">                                route add default gw $i dev $interface</span><br><span class="line">                        done</span><br><span class="line">                fi</span><br><span class="line"></span><br><span class="line">                echo -n &gt; $RESOLV_CONF</span><br><span class="line">                [ -n &quot;$domain&quot; ] &amp;&amp; echo search $domain &gt;&gt; $RESOLV_CONF</span><br><span class="line">                for i in $dns ; do</span><br><span class="line">                        echo adding dns $i</span><br><span class="line">                        echo nameserver $i &gt;&gt; $RESOLV_CONF</span><br><span class="line">                done</span><br><span class="line">                ;;</span><br><span class="line">esac</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><h2 id="dhcpcd配置静态IP"><a href="#dhcpcd配置静态IP" class="headerlink" title="dhcpcd配置静态IP"></a>dhcpcd配置静态IP</h2><p>配置文件<code>/etc/dhcpcd.conf</code></p><p>追加IP配置信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface eth0</span><br><span class="line">static ip_address=172.16.xx.xx/24       #配置IP地址  </span><br><span class="line">static routers=172.16.xx.xx             #网关</span><br><span class="line">static domain_name_servers=172.16.xx.xx #DNS</span><br></pre></td></tr></table></figure></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://wizardforcel.gitbooks.io/network-basic/content/30.html" target="_blank" rel="noopener">网络基本功（三十一）：细说DHCP</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;动态主机设置协议（英语：Dynamic Host Configuration Protocol，DHCP）是一个局域网的网络协议，使用UDP协议工作，主要有两个用途：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用于内部网或网络服务供应商自动分配IP地址；&lt;/li&gt;
&lt;li&gt;给用户用于内部网管理员作为对所有计算机作中央管理的手段。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;DHCP从一个IP地址池中提供IP地址，该池有DHCP服务器数据库定义，称为scope。如果客户端接受这一地址，则它可在一个预定义的期限内使用该地址，称为&lt;code&gt;租约&lt;/code&gt;。如果客户端无法从DHCP服务器获取IP地址，它就无法正常初始化TCP/IP。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DHCP采用的C/S架构,客户端有&lt;code&gt;udhcpc&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
    
    </summary>
    
      <category term="网络" scheme="http://winddoing.github.io/categories/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="DHCP" scheme="http://winddoing.github.io/categories/%E7%BD%91%E7%BB%9C/DHCP/"/>
    
    
      <category term="DHCP" scheme="http://winddoing.github.io/tags/DHCP/"/>
    
  </entry>
  
</feed>
